http://www.davespace.co.uk/arm/introduction-to-arm/conditional.html
HTTP/1.1 200 OK
Server: Zeus/4.3
Last-Modified: Sun, 08 Jun 2014 19:51:42 GMT
Vary: Accept-Encoding
Content-Type: text/html
Accept-Ranges: bytes
Content-Encoding: gzip
Content-Length: 4667
Date: Wed, 23 Jul 2014 11:45:52 GMT
X-Varnish: 343544745
Age: 0
Via: 1.1 varnish
Connection: close


<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="author" content="David Thomas">
  <meta name="keywords" content="DaveSpace, David Thomas, Dave Thomas">
  <meta name="description" content="David Thomas's website.">

  <title>ARM: Introduction to ARM: Conditional Execution | DaveSpace</title>

  <link rel="icon" type="image/vnd.microsoft.icon" href="../../favicon.ico" />
  <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../favicon.ico" />

  <link rel="stylesheet" type="text/css" href="../../style/flat.css">

  <link rel="alternate" type="application/atom+xml" title="DaveSpace feed" href="../../blog.atom">

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29131837-1']);
    _gaq.push(['_trackPageview']);
    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>
<body id="arm">

  <div id="header">
    <h1><i class="fa fa-cogs"></i> <a href="../../">DaveSpace</a></h1>
  </div>

  <div id="nav">
    

<h4>ARM:<br/>Introduction to ARM</h4>
<ul class="fa-ul">
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/">Start</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/why-learn.html">Why Learn Assembly Language?</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/not-trivial.html">Not a Trivial Mapping</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/instruction-sets.html">Instruction Sets</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/registers.html">Registers</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/pc.html">Program Counter</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/syntax.html">Instruction Syntax</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/organisation.html">Organisation</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/movement.html">Movement</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arithmetic.html">Arithmetic Instructions</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/logical.html">Logical Instructions</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/compare.html">Compare Instructions</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/barrel-shifter.html">Barrel Shifter</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/operand2.html">Operand2</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/immediates.html">Immediate Values</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/branch.html">Branch Instructions</a></li>
  
  <li><i class="fa-li fa fa-dot-circle-o"></i> <a href="../../arm/introduction-to-arm/conditional.html">Conditional Execution</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/multiply.html">Multiply Instructions</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/data-transfer.html">Single Register Data Transfer</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/addressing.html">Addressing Modes</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/multiple-data-transfer.html">Multiple Register Data Transfer</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/stack.html">The Stack</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/chain.html">A Call Chain</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/task-one.html">Task One</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/task-one-answers.html">Task One - Answers</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/task-two.html">Task Two</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/task-two-answers.html">Task Two - Answers</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/thumb.html">Thumb</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/interworking.html">Interworking</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/thumb-example.html">Thumb Example</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/thumb-2.html">Thumb-2</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-ltd.html">ARM Ltd.</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-tools.html">Tools</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-apps.html">Applications</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-arch.html">ARM Architecture</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-arch123.html">Early Architectures</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-arch4.html">Architecture 4</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-arch5.html">Architecture 5</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-arch6.html">Architecture 6</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-arch7.html">Architecture 7</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-cores.html">Summary of current ARM cores</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-inside.html">What’s inside various devices?</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/arm-test.html">Test</a></li>
  
  <li><i class="fa-li fa fa-circle-o"></i> <a href="../../arm/introduction-to-arm/books.html">Books</a></li>
  
</ul>


    
<h4>Categories</h4>
<ul class="fa-ul">
  <li><i class="fa-li fa fa-chevron-circle-right"></i> <a href="../../arm/">ARM</a></li>
  <li><i class="fa-li fa fa-chevron-circle-right"></i> <a href="../../doodles/">Doodles</a></li>
  <li><i class="fa-li fa fa-chevron-circle-right"></i> <a href="../../projects/">Projects</a></li>
  <li><i class="fa-li fa fa-chevron-circle-right"></i> <a href="../../python/">Python</a></li>
  <li><i class="fa-li fa fa-chevron-circle-right"></i> <a href="../../risc.os/">RISC&nbsp;OS</a></li>
</ul>

    
<h4>Tags</h4>
<p><a href="../../tags/EfficientC.html">EfficientC</a> <a href="../../tags/Slide.html">Slide</a> <a href="../../tags/BasicOptimisation.html">BasicOptimisation</a> <a href="../../tags/TargetedOptimisation.html">TargetedOptimisation</a> <a href="../../tags/MotionMasks.html">MotionMasks</a> <a href="../../tags/Game.html">Game</a> <a href="../../tags/TheGreatEscape.html">TheGreatEscape</a> <a href="../../tags/Script.html">Script</a> <a href="../../tags/Python.html">Python</a> <a href="../../tags/Iyonix.html">Iyonix</a> <a href="../../tags/QuickFiler.html">QuickFiler</a> <a href="../../tags/ARM.html">ARM</a> <a href="../../tags/IntroductionToARM.html">IntroductionToARM</a> <a href="../../tags/RISC OS.html">RISC OS</a> <a href="../../tags/PrivateEye.html">PrivateEye</a> <a href="../../tags/PhotoFiler.html">PhotoFiler</a> <a href="../../tags/Geminus.html">Geminus</a> <a href="../../tags/Toolbar.html">Toolbar</a> <a href="../../tags/Site.html">Site</a> <a href="../../tags/Containers.html">Containers</a> <a href="../../tags/GitHub.html">GitHub</a> <a href="../../tags/Hardware.html">Hardware</a> <a href="../../tags/Doodle.html">Doodle</a> <a href="../../tags/Trace.html">Trace</a> <a href="../../tags/Project.html">Project</a> </p>


    
<h4>About me</h4>
<ul class="fa-ul">
  <li><i class="fa-li fa fa-male"></i> David Thomas</li>
  <li><i class="fa-li fa fa-wrench"></i> Software Engineer</li>
  <li><i class="fa-li fa fa-location-arrow"></i> Glasgow, Scotland</li>
</ul>

<h5>Contact</h5>
<ul class="fa-ul">
  <li><i class="fa-li fa fa-envelope"></i> Email<br/> <a href="mailto:dave@davespace.co.uk">dave@davespace.co.uk</a></li>
  <li><i class="fa-li fa fa-twitter"></i> Twitter<br/> <a href="https://twitter.com/bagospanners">@bagospanners</a></li>
  <li><i class="fa-li fa fa-users"></i> IRC<br/> <em>spanners</em> on <a href="http://freenode.net/">Freenode</a></li>
</ul>

<h5>Tasty Links</h5>
<ul class="fa-ul">
  <li><i class="fa-li fa fa-github"></i> <a href="https://github.com/dpt">dpt on GitHub</a><br/>
  – my projects</li>
  <li><i class="fa-li fa fa-twitter"></i> <a href="https://twitter.com/bagospannersurl">@bagospannersurl</a><br/>
  – interesting links</li>
  <li><i class="fa-li fa fa-paperclip"></i> <a href="https://delicious.com/dpt">dpt on delicious</a><br/>
  – older interesting links</li>
</ul>

  </div>

<!-- start page -->

<!-- start post -->
<article>
  <header>
    <!-- start post header -->
    <h1><i class="fa fa-compass"></i> ARM: Introduction to ARM: Conditional Execution</h1>
    
<!-- start meta -->
<div class="meta">
  by <span class="author">David Thomas</span> on <time datetime="2012-03-03T00:00:00Z">03 March 2012</time> &mdash;
  <ul>
    <li><i class="fa fa-tag"></i> <a href="../../tags/ARM.html">ARM</a></li>
<li><i class="fa fa-tag"></i> <a href="../../tags/IntroductionToARM.html">IntroductionToARM</a></li>
<li><i class="fa fa-tag"></i> <a href="../../tags/Slide.html">Slide</a></li>

  </ul>
</div>
<!-- end meta -->

    <!-- end post header -->
  </header>

  
  <!-- start post content -->
  <section>
    <section>
<div class="slide">

<h2>Conditional Execution</h2>

<p>A beneficial feature of the ARM architecture is that instructions can be made to execute conditionally. This is common in other architectures’ branch or jump instructions but ARM allows its use with most mnemonics.</p>

<p>The condition is specified with a two-letter suffix, such as <code>EQ</code> or <code>CC</code>, appended to the mnemonic. The condition is tested against the current processor flags and if not met the instruction is treated as a no-op. This feature often removes the need to branch, avoiding pipeline stalls and increasing speed. It can also increase code density.</p>

<p>By default the data processing instructions do not affect the condition code flags but can be made to by suffixing <code>S</code>. The comparison instructions <code>CMP</code>, <code>TST</code>, and co. do this implicitly.</p>

</div>
</section>
<section>
<div class="examples">

<h2>Examples</h2>

<p>The following code fragment is a loop which runs until the counter in R1 hits zero, at which point the condition code <code>NE</code> (not equal to zero) controlling the branch becomes false.</p>

<div class="highlight"><pre>    <span class="k">MOV</span>   r1, <span class="mi">#10</span>
<span class="nf">loop</span>
    ...
    <span class="k">SUBS</span>  r1, r1, <span class="mi">#1</span>
    <span class="k">BNE</span>   loop
</pre></div>
  

</div>
</section>
<section>
<div class="slide">

<h2>Flags</h2>

<p>The top end of the program status register looks like this:</p>

<p><img src="img/dia/nzcv.png" alt="Flags diagram showing N, Z, C and V flag bits.">
</p>

<p>When an ALU operation changes the flags:</p>

<ul>
<li>N – Negative

<ul>
<li>is set if the result of a data processing instruction was negative.</li>
</ul></li>
<li>Z – Zero

<ul>
<li>is set if the result was zero.</li>
</ul></li>
<li>C – Carry

<ul>
<li>is set if an addition, subtraction or compare causes a result bigger than 32 bits, or is set from the output of the shifter for move and logical instructions.</li>
</ul></li>
<li>V – Overflow

<ul>
<li>is set if an addition, subtraction or compare produces a signed result bigger than 31 bits.</li>
</ul></li>
</ul>

<h2>Condition Codes</h2>

<table>
<thead>
<tr>
<td>Code</td>
<td>Suffix</td>
<td>Description</td>
<td>Flags</td>
</tr>
</thead>

<tbody>
<tr>
<td>0000</td>
<td>EQ</td>
<td>Equal / equals zero</td>
<td>Z</td>
</tr>

<tr>
<td>0001</td>
<td>NE</td>
<td>Not equal</td>
<td>!Z</td>
</tr>

<tr>
<td>0010</td>
<td>CS / HS</td>
<td>Carry set / unsigned higher or same</td>
<td>C</td>
</tr>

<tr>
<td>0011</td>
<td>CC / LO</td>
<td>Carry clear / unsigned lower</td>
<td>!C</td>
</tr>

<tr>
<td>0100</td>
<td>MI</td>
<td>Minus / negative</td>
<td>N</td>
</tr>

<tr>
<td>0101</td>
<td>PL</td>
<td>Plus / positive or zero</td>
<td>!N</td>
</tr>

<tr>
<td>0110</td>
<td>VS</td>
<td>Overflow</td>
<td>V</td>
</tr>

<tr>
<td>0111</td>
<td>VC</td>
<td>No overflow</td>
<td>!V</td>
</tr>

<tr>
<td>1000</td>
<td>HI</td>
<td>Unsigned higher</td>
<td>C and !Z</td>
</tr>

<tr>
<td>1001</td>
<td>LS</td>
<td>Unsigned lower or same</td>
<td>!C or Z</td>
</tr>

<tr>
<td>1010</td>
<td>GE</td>
<td>Signed greater than or equal</td>
<td>N == V</td>
</tr>

<tr>
<td>1011</td>
<td>LT</td>
<td>Signed less than</td>
<td>N != V</td>
</tr>

<tr>
<td>1100</td>
<td>GT</td>
<td>Signed greater than</td>
<td>!Z and (N == V)</td>
</tr>

<tr>
<td>1101</td>
<td>LE</td>
<td>Signed less than or equal</td>
<td>Z or (N != V)</td>
</tr>

<tr>
<td>1110</td>
<td>AL</td>
<td>Always (default)</td>
<td>any</td>
</tr>
</tbody>
</table>

</div>
</section>
<section>
<div class="remarks">

<h2>Remarks</h2>

<p>The (omitted from slide) <code>NV</code> condition code is deprecated. Though it originally provided an analogue for the <code>AL</code> condition code, it was more useful to recover the 2<sup>24</sup> instructions its presence consumed.</p>

</div>
</section>
<section>
<div class="examples">

<h2>Examples</h2>

<p>Use a sequence of several conditional instructions:</p>

<div class="highlight"><pre>    <span class="k">CMP</span>   r0, <span class="mi">#5</span>   <span class="c1">; if (a == 5)</span>
    <span class="k">MOVEQ</span> r0, <span class="mi">#10</span>  
    <span class="k">BLEQ</span>  fn       <span class="c1">;   fn(10)</span>
</pre></div>

<p>(Assume <code>a</code> is in R0. Compare R0 to 5. The next two instructions will be
executed only if the compare returns EQual. They move 10 into R0, then call
‘<code>fn</code>’ (branch with link, <code>BL</code>).)</p>

<p>Set the flags, then use various condition codes:</p>

<div class="highlight"><pre>    <span class="k">CMP</span>   r0, <span class="mi">#0</span>   <span class="c1">; if (x <= 0)</span>
    <span class="k">MOVLE</span> r0, <span class="mi">#0</span>   <span class="c1">;   x = 0;</span>
    <span class="k">MOVGT</span> r0, <span class="mi">#1</span>   <span class="c1">; else x = 1;</span>
</pre></div>

<p>Use conditional compare instructions:</p>

<div class="highlight"><pre>    <span class="k">CMP</span>   r0, #<span class="sc">'A'</span> <span class="c1">; if (c == 'A'</span>
    <span class="k">CMPNE</span> r0, #'<span class="k">B</span>' <span class="c1">;  || c == 'B')</span>
    <span class="k">MOVEQ</span> r1, <span class="mi">#1</span>   <span class="c1">;   y = 1;</span>
</pre></div>

<p>A sequence which doesn’t use conditional execution:</p>

<div class="highlight"><pre>    <span class="k">CMP</span>   r3, <span class="mi">#0</span>
    <span class="k">BEQ</span>   next
    <span class="k">ADD</span>   r0, r0, r1
    <span class="k">SUB</span>   r0, r0, r2
<span class="nf">next</span>
...
</pre></div>

<p>By transforming the sequence with conditional execution an instruction can be
removed:</p>

<div class="highlight"><pre>    <span class="k">CMP</span>   r3, <span class="mi">#0</span>
    <span class="k">ADDNE</span> r0, r0, r1
    <span class="k">SUBNE</span> r0, r0, r2
    ...
</pre></div>

</div>
</section>
<section>
<div class="remarks">

<h2>Remarks</h2>

<p>Some of the newer instructions such as <code>PLD</code> or <code>BLX</code> can’t be conditionally executed. These are encoded using the instruction space occupied by the now-obsolete <code>NV</code> (never execute) condition code.</p>

<p>It’s possible to combine the <code>S</code> bit with conditional execution, e.g. <code>ADDEQS r0, r1, r2</code>.</p>

<p>The only compiler which makes extensive use of condition codes is ARMCC. It applies them in an optimisation pass called branch removal.</p>

<p>When is it worth branching over condition codes? Depends on the CPU’s branch penalty, but it’s often 4..6 instructions.</p>
</div>
</section>

    
<!-- start flip -->

<div class="flip">
  <h2>Navigate</h2>
  <div class="previous">
    <a href="branch.html"><i class="fa fa-arrow-circle-left"></i> 

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
  Branch Instructions
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

</a>
  </div>
  <div class="next">
    <a href="multiply.html">

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
  Multiply Instructions
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

 <i class="fa fa-arrow-circle-right"></i></a>
  </div>
</div>

<!-- end flip -->

  </section>
  <!-- end post content -->
</article>
<!-- end post -->

<!-- end page -->

  <div id="footer">
    Copyright © David Thomas, 2005-2014<br/>
    Built using <i class="fa fa-leaf"></i> <a href="https://github.com/piranha/gostatic">gostatic</a> and <i class="fa fa-flag"></i> <a href="http://fontawesome.io/">Font Awesome</a><br/>
    <strong>Like this Site?</strong> Send <i class="fa fa-btc"></i> to 1PSXsRq4gXWKsxWSbmvmjCWsmD49MdNgJN to support it. Thanks!
  </div>
</body>
</html>


