http://www.depesz.com/2013/01/28/index-on-ab-vs-ba/
HTTP/1.1 200 OK
Server: nginx
Date: Thu, 24 Jul 2014 06:23:37 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/5.5.12-1
X-Pingback: http://www.depesz.com/xmlrpc.php
Link: <http://www.depesz.com/?p=2594>; rel=shortlink

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="coder" content="MHweb.pl" />
<title>select * from depesz;  &raquo; Blog Archive   &raquo; Index on (a,b) vs. (b,a)?</title>
<meta name="generator" content="WordPress 3.9.1" /> <!-- leave this for stats -->
<link rel="stylesheet" href="http://www.depesz.com/wp-content/themes/depesz/style.css" type="text/css" media="screen" />
<!-- <link rel="stylesheet" href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/style1.css" type="text/css" media="screen" /> -->

<link rel="alternate" type="application/rss+xml" title="select * from depesz; RSS Feed" href="http://www.depesz.com/feed/" />
<link rel="pingback" href="http://www.depesz.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="select * from depesz; &raquo; Index on (a,b) vs. (b,a)? Comments Feed" href="http://www.depesz.com/2013/01/28/index-on-ab-vs-ba/feed/" />
<link rel='stylesheet' id='cookie-style-css'  href='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.depesz.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.depesz.com/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.0.3' type='text/css' media='all' />
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var user_options = {"messageContent":"In order for this site to work properly, and in order to evaluate and improve the site we need to store small files (called cookies) on your computer.<br\/> Over 90% of all websites do this, however, since the 25th of May 2011 we are required by EU regulations to obtain your consent first. What do you say?","redirectLink":"http:\/\/google.com","okText":"That's fine","notOkText":"I don't agree","cookieName":"jsCookiewarning29Check","ajaxUrl":"http:\/\/www.depesz.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.js?ver=3.9.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.depesz.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.depesz.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://www.depesz.com/2013/01/28/index-on-ab-vs-ba/' />
<link rel='shortlink' href='http://www.depesz.com/?p=2594' />

<link rel="stylesheet" href="http://www.depesz.com/wp-content/plugins/dd-formmailer/dd-formmailer.css" type="text/css" media="screen" />
<style type="text/css">

</style>
<!--[if lte IE 7]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 6]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
</head>
<body>
<div id="box">
	<div id="up">
		<div id="logo"></div>
		<div id="menu">

			<div class="lc"></div>
			
			<div class="main">
				<div id="nav">
					<ul class="nav">
					<li class="first"><a href="http://www.depesz.com">Blog</a></li>
					<li class="page_item page-item-1947"><a href="http://www.depesz.com/projects/">Projects</a></li>
<li class="page_item page-item-1618"><a href="http://www.depesz.com/contact/">Contact</a></li>
					</ul>
				</div>
			</div>

			<div class="rc"></div>

		</div>
	</div>

	<div id="top_cont"></div>
	<div id="mainbck">



	<div id="content">

	
		<div class="entry">
			<div class="post" id="post-2594">
				<div class="topek">
					<div class="name">
						<a href="http://www.depesz.com/2013/01/28/index-on-ab-vs-ba/" rel="bookmark" title="Permanent Link to Index on (a,b) vs. (b,a)?">Index on (a,b) vs. (b,a)?</a><div class="rss-img"><a href="http://www.depesz.com/feed/">&nbsp;&nbsp;</a></div>
					</div>

					<small>January 28th, 2013 by depesz | Tags: <a href="http://www.depesz.com/tag/comparison/" rel="tag">comparison</a>, <a href="http://www.depesz.com/tag/index/" rel="tag">index</a>, <a href="http://www.depesz.com/tag/postgresql/" rel="tag">postgresql</a>, <a href="http://www.depesz.com/tag/selectivity/" rel="tag">selectivity</a> |  <a href="http://www.depesz.com/2013/01/28/index-on-ab-vs-ba/#comments" title="Comment on Index on (a,b) vs. (b,a)?">7 comments &#187;</a></small>
<br><small><big>Did it help? If yes - maybe you can help me? Donate BTC to <a href="https://blockchain.info/address/19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx">19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx</a></big></small>
				</div>
				
				<div class="the">
					<p>Whenever you are considering creation of multicolumn index, there is a question what should be the order of columns in this index. I'll try to analyze various cases of this situation.</p>
<p><span id="more-2594"></span></p>
<p>We need to consider two separate issues:</p>
<ul>
<li>what operators are you going to use</li>
<li>What is selectivity of the fields</li>
</ul>
<p>First, let's consider that you want to use inequality operators (&lt;, &gt;, &lt;= or &gr;=), and you're using both columns in your query. In this case, you can generally assume both conditions use index.</p>
<p>Some test data:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">table</span> t1 <span style="color: #66cc66;">&#40;</span> a int4<span style="color: #66cc66;">,</span> b int4 <span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span>
$ <span style="color: #993333; font-weight: bold;">insert</span> <span style="color: #993333; font-weight: bold;">into</span> t1 <span style="color: #66cc66;">&#40;</span>a<span style="color: #66cc66;">,</span>b<span style="color: #66cc66;">&#41;</span>
    <span style="color: #993333; font-weight: bold;">select</span> random<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">*</span><span style="color: #cc66cc;">100000</span><span style="color: #66cc66;">,</span> random<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">*</span><span style="color: #cc66cc;">100000</span>
    <span style="color: #993333; font-weight: bold;">from</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">1000000</span><span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #cc66cc;">0</span> <span style="color: #cc66cc;">1000000</span>
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">index</span> i1 <span style="color: #993333; font-weight: bold;">on</span> t1 <span style="color: #66cc66;">&#40;</span>a<span style="color: #66cc66;">,</span>b<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">INDEX</span>
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">table</span> t2 <span style="color: #66cc66;">&#40;</span> a int4<span style="color: #66cc66;">,</span> b int4 <span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span>
$ <span style="color: #993333; font-weight: bold;">insert</span> <span style="color: #993333; font-weight: bold;">into</span> t2 <span style="color: #66cc66;">&#40;</span>a<span style="color: #66cc66;">,</span>b<span style="color: #66cc66;">&#41;</span>
    <span style="color: #993333; font-weight: bold;">select</span> random<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">*</span><span style="color: #cc66cc;">100000</span><span style="color: #66cc66;">,</span> random<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">*</span><span style="color: #cc66cc;">100000</span>
    <span style="color: #993333; font-weight: bold;">from</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">1000000</span><span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #cc66cc;">0</span> <span style="color: #cc66cc;">1000000</span>
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">index</span> i2 <span style="color: #993333; font-weight: bold;">on</span> t2 <span style="color: #66cc66;">&#40;</span>b<span style="color: #66cc66;">,</span>a<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">INDEX</span></pre></td></tr></table></div>

<p>And let's see &#8211; simple select that should return now much rows:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">explain</span> analyze
<span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span>
<span style="color: #993333; font-weight: bold;">from</span>
t1
<span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">1000</span>
<span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">&gt;</span> <span style="color: #cc66cc;">99000</span>;
                                                   QUERY PLAN
<span style="color: #808080; font-style: italic;">-----------------------------------------------------------------------------------------------------------------</span>
 Bitmap Heap Scan <span style="color: #993333; font-weight: bold;">on</span> t1  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">424.96</span><span style="color: #66cc66;">..</span>1074<span style="color: #66cc66;">.</span>04 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">182</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1.673</span><span style="color: #66cc66;">..</span>2<span style="color: #66cc66;">.</span>879 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">205</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   Recheck Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">1000</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">&gt;</span> <span style="color: #cc66cc;">99000</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #66cc66;">-&gt;</span>  Bitmap <span style="color: #993333; font-weight: bold;">Index</span> Scan <span style="color: #993333; font-weight: bold;">on</span> i1  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.00</span><span style="color: #66cc66;">..</span>424<span style="color: #66cc66;">.</span>92 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">182</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1.624</span><span style="color: #66cc66;">..</span>1<span style="color: #66cc66;">.</span>624 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">205</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
         <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">1000</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">&gt;</span> <span style="color: #cc66cc;">99000</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
 Total runtime: <span style="color: #cc66cc;">2.940</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">5</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>And with index the other way around:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">explain</span> analyze
<span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span>
<span style="color: #993333; font-weight: bold;">from</span>
t2
<span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">1000</span>
<span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">&gt;</span> <span style="color: #cc66cc;">99000</span>;
                                                   QUERY PLAN
<span style="color: #808080; font-style: italic;">----------------------------------------------------------------------------------------------------------------</span>
 Bitmap Heap Scan <span style="color: #993333; font-weight: bold;">on</span> t2  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">229.76</span><span style="color: #66cc66;">..</span>592<span style="color: #66cc66;">.</span>85 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">103</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1.095</span><span style="color: #66cc66;">..</span>1<span style="color: #66cc66;">.</span>768 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">95</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   Recheck Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">&gt;</span> <span style="color: #cc66cc;">99000</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">1000</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #66cc66;">-&gt;</span>  Bitmap <span style="color: #993333; font-weight: bold;">Index</span> Scan <span style="color: #993333; font-weight: bold;">on</span> i2  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.00</span><span style="color: #66cc66;">..</span>229<span style="color: #66cc66;">.</span>74 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">103</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1.056</span><span style="color: #66cc66;">..</span>1<span style="color: #66cc66;">.</span>056 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">95</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
         <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">&gt;</span> <span style="color: #cc66cc;">99000</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">1000</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
 Total runtime: <span style="color: #cc66cc;">1.824</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">5</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>Now, what about a mix of equality and inequality?</p>
<p>First, with equality being used on first column in index:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">explain</span> analyze <span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">from</span> t1 <span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">123</span> <span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">&gt;=</span> <span style="color: #cc66cc;">99000</span>;
                                                 QUERY PLAN
<span style="color: #808080; font-style: italic;">------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Index</span> <span style="color: #993333; font-weight: bold;">Only</span> Scan <span style="color: #993333; font-weight: bold;">using</span> i1 <span style="color: #993333; font-weight: bold;">on</span> t1  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.43</span><span style="color: #66cc66;">..</span>8<span style="color: #66cc66;">.</span>45 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.027</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>027 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">123</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">&gt;=</span> <span style="color: #cc66cc;">99000</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   Heap Fetches: <span style="color: #cc66cc;">0</span>
 Total runtime: <span style="color: #cc66cc;">0.083</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">4</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>and what about the case where inequality is first?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">explain</span> analyze <span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">from</span> t2 <span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">123</span> <span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">&gt;=</span> <span style="color: #cc66cc;">99000</span>;
                                                  QUERY PLAN
<span style="color: #808080; font-style: italic;">--------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Index</span> <span style="color: #993333; font-weight: bold;">Only</span> Scan <span style="color: #993333; font-weight: bold;">using</span> i2 <span style="color: #993333; font-weight: bold;">on</span> t2  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.42</span><span style="color: #66cc66;">..</span>233<span style="color: #66cc66;">.</span>75 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.831</span><span style="color: #66cc66;">..</span>1<span style="color: #66cc66;">.</span>005 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">&gt;=</span> <span style="color: #cc66cc;">99000</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">123</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   Heap Fetches: <span style="color: #cc66cc;">1</span>
 Total runtime: <span style="color: #cc66cc;">1.049</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">4</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>Hurray &#8211; it also works. But one thing &#8211; the second case is more expensive. To show it, let's make a special case:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">table</span> t3 <span style="color: #66cc66;">&#40;</span>a int4<span style="color: #66cc66;">,</span> b int4<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">insert</span> <span style="color: #993333; font-weight: bold;">into</span> t3 <span style="color: #993333; font-weight: bold;">select</span> i<span style="color: #66cc66;">,</span> j <span style="color: #993333; font-weight: bold;">from</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">10000</span><span style="color: #66cc66;">&#41;</span> i<span style="color: #66cc66;">,</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span> j;
<span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #cc66cc;">0</span> <span style="color: #cc66cc;">1000000</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">index</span> i3 <span style="color: #993333; font-weight: bold;">on</span> t3 <span style="color: #66cc66;">&#40;</span>a<span style="color: #66cc66;">,</span> b<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">INDEX</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">table</span> t4 <span style="color: #66cc66;">&#40;</span>a int4<span style="color: #66cc66;">,</span> b int4<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">insert</span> <span style="color: #993333; font-weight: bold;">into</span> t4 <span style="color: #993333; font-weight: bold;">select</span> i<span style="color: #66cc66;">,</span> j <span style="color: #993333; font-weight: bold;">from</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">10000</span><span style="color: #66cc66;">&#41;</span> i<span style="color: #66cc66;">,</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span> j;
<span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #cc66cc;">0</span> <span style="color: #cc66cc;">1000000</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">index</span> i4 <span style="color: #993333; font-weight: bold;">on</span> t4 <span style="color: #66cc66;">&#40;</span>b<span style="color: #66cc66;">,</span> a<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">INDEX</span></pre></td></tr></table></div>

<p>As you can see column a has pretty good selectivity, while column b much lower.</p>
<p>Now, when I'll first use equality, and then inequality:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">explain</span> analyze
<span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">from</span> t3 <span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">123</span> <span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">50</span>;
                                                  QUERY PLAN
<span style="color: #808080; font-style: italic;">---------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Index</span> <span style="color: #993333; font-weight: bold;">Only</span> Scan <span style="color: #993333; font-weight: bold;">using</span> i3 <span style="color: #993333; font-weight: bold;">on</span> t3  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.42</span><span style="color: #66cc66;">..</span>91<span style="color: #66cc66;">.</span>64 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">48</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.064</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>084 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">49</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">123</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">50</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   Heap Fetches: <span style="color: #cc66cc;">49</span>
 Total runtime: <span style="color: #cc66cc;">0.141</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">4</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>If it's the other way around:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">explain</span> analyze
<span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">from</span> t4 <span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">123</span> <span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">50</span>;
                                                    QUERY PLAN
<span style="color: #808080; font-style: italic;">-------------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Index</span> <span style="color: #993333; font-weight: bold;">Only</span> Scan <span style="color: #993333; font-weight: bold;">using</span> i4 <span style="color: #993333; font-weight: bold;">on</span> t4  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.42</span><span style="color: #66cc66;">..</span>10434<span style="color: #66cc66;">.</span>23 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">48</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.077</span><span style="color: #66cc66;">..</span>32<span style="color: #66cc66;">.</span>651 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">49</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">50</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">123</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   Heap Fetches: <span style="color: #cc66cc;">49</span>
 Total runtime: <span style="color: #cc66cc;">32.676</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">4</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>Of course one can say &#8211; OK, you used equality for very selective, and inequality for not really selective column. What would happen if the conditions were swapped?</p>
<p>Let's see:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">explain</span> analyze
<span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">from</span> t3
<span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">100</span>
<span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">80</span>;
                                                   QUERY PLAN
<span style="color: #808080; font-style: italic;">-----------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Index</span> <span style="color: #993333; font-weight: bold;">Only</span> Scan <span style="color: #993333; font-weight: bold;">using</span> i3 <span style="color: #993333; font-weight: bold;">on</span> t3  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.42</span><span style="color: #66cc66;">..</span>402<span style="color: #66cc66;">.</span>17 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">107</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.045</span><span style="color: #66cc66;">..</span>2<span style="color: #66cc66;">.</span>292 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">99</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">80</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   Heap Fetches: <span style="color: #cc66cc;">99</span>
 Total runtime: <span style="color: #cc66cc;">2.353</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">4</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">explain</span> analyze
<span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">from</span> t4
<span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">100</span>
<span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">80</span>;
                                                 QUERY PLAN
<span style="color: #808080; font-style: italic;">-------------------------------------------------------------------------------------------------------------</span>
 Bitmap Heap Scan <span style="color: #993333; font-weight: bold;">on</span> t4  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">5.32</span><span style="color: #66cc66;">..</span>318<span style="color: #66cc66;">.</span>02 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">87</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.094</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>283 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">99</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   Recheck Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">80</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #66cc66;">-&gt;</span>  Bitmap <span style="color: #993333; font-weight: bold;">Index</span> Scan <span style="color: #993333; font-weight: bold;">on</span> i4  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.00</span><span style="color: #66cc66;">..</span>5<span style="color: #66cc66;">.</span>29 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">87</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.067</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>067 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">99</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
         <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">80</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">&lt;</span> <span style="color: #cc66cc;">100</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
 Total runtime: <span style="color: #cc66cc;">0.344</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">5</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>This shows, in my opinion that in mixed cases (one field using =, and the other some inequality), it's better to have index first on field used for equality.</p>
<p>Which leaves us with relatively simple case &#8211; what about case where we have both columns compared using equality, just their selectivity is widely different.</p>
<p>And let's make it really very different. Like:</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;">$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">table</span> t5 <span style="color: #66cc66;">&#40;</span>a int4<span style="color: #66cc66;">,</span> b int4<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">insert</span> <span style="color: #993333; font-weight: bold;">into</span> t5 <span style="color: #993333; font-weight: bold;">select</span> i<span style="color: #66cc66;">,</span> j <span style="color: #993333; font-weight: bold;">from</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">5000000</span><span style="color: #66cc66;">&#41;</span> i<span style="color: #66cc66;">,</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#41;</span> j;
<span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #cc66cc;">0</span> <span style="color: #cc66cc;">10000000</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">index</span> i5 <span style="color: #993333; font-weight: bold;">on</span> t5 <span style="color: #66cc66;">&#40;</span>a<span style="color: #66cc66;">,</span> b<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">INDEX</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">table</span> t6 <span style="color: #66cc66;">&#40;</span>a int4<span style="color: #66cc66;">,</span> b int4<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">insert</span> <span style="color: #993333; font-weight: bold;">into</span> t6 <span style="color: #993333; font-weight: bold;">select</span> i<span style="color: #66cc66;">,</span> j <span style="color: #993333; font-weight: bold;">from</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">5000000</span><span style="color: #66cc66;">&#41;</span> i<span style="color: #66cc66;">,</span> generate_series<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">2</span><span style="color: #66cc66;">&#41;</span> j;
<span style="color: #993333; font-weight: bold;">INSERT</span> <span style="color: #cc66cc;">0</span> <span style="color: #cc66cc;">10000000</span>
&nbsp;
$ <span style="color: #993333; font-weight: bold;">create</span> <span style="color: #993333; font-weight: bold;">index</span> i6 <span style="color: #993333; font-weight: bold;">on</span> t6 <span style="color: #66cc66;">&#40;</span>b<span style="color: #66cc66;">,</span> a<span style="color: #66cc66;">&#41;</span>;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">INDEX</span></pre></td></tr></table></div>

<p>Another set of tables. In both, a has 500,000 different values, while b has just two.</p>
<p>How are the speeds now?</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">explain</span> analyze
<span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">from</span> t5 <span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">2314</span> <span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">1</span>;
                                                 QUERY PLAN
<span style="color: #808080; font-style: italic;">------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Index</span> <span style="color: #993333; font-weight: bold;">Only</span> Scan <span style="color: #993333; font-weight: bold;">using</span> i5 <span style="color: #993333; font-weight: bold;">on</span> t5  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.43</span><span style="color: #66cc66;">..</span>8<span style="color: #66cc66;">.</span>46 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.009</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>009 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">2314</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   Heap Fetches: <span style="color: #cc66cc;">1</span>
 Total runtime: <span style="color: #cc66cc;">0.028</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">4</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span>
&nbsp;
<span style="color: #993333; font-weight: bold;">explain</span> analyze
<span style="color: #993333; font-weight: bold;">select</span> <span style="color: #66cc66;">*</span> <span style="color: #993333; font-weight: bold;">from</span> t6 <span style="color: #993333; font-weight: bold;">where</span> a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">2314</span> <span style="color: #993333; font-weight: bold;">and</span> b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">1</span>;
                                                 QUERY PLAN
<span style="color: #808080; font-style: italic;">------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #993333; font-weight: bold;">Index</span> <span style="color: #993333; font-weight: bold;">Only</span> Scan <span style="color: #993333; font-weight: bold;">using</span> i6 <span style="color: #993333; font-weight: bold;">on</span> t6  <span style="color: #66cc66;">&#40;</span>cost<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.43</span><span style="color: #66cc66;">..</span>8<span style="color: #66cc66;">.</span>46 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span> width<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#40;</span>actual <span style="color: #993333; font-weight: bold;">time</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">0.010</span><span style="color: #66cc66;">..</span>0<span style="color: #66cc66;">.</span>010 <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span> loops<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span>
   <span style="color: #993333; font-weight: bold;">Index</span> Cond: <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#40;</span>b <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AND</span> <span style="color: #66cc66;">&#40;</span>a <span style="color: #66cc66;">=</span> <span style="color: #cc66cc;">2314</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span>
   Heap Fetches: <span style="color: #cc66cc;">1</span>
 Total runtime: <span style="color: #cc66cc;">0.028</span> ms
<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">4</span> <span style="color: #993333; font-weight: bold;">rows</span><span style="color: #66cc66;">&#41;</span></pre></td></tr></table></div>

<p>(No, I didn't edit the results &#8211; I made script which called both explains 3 times in a row, and stored output of last one)</p>
<p>Looks like there is no difference. Of course &#8211; it might be that my sample size is too small, but still &#8211; 5 million rows in an index is pretty good test case.</p>
<p>So, to wrap it up:</p>
<ul>
<li>in case you're using a = ? and b = ? &#8211; there is no time difference between index on (a,b) and (b,a)</li>
<li>in case you're using a = ? and b &lt;/&gt; ? &#8211; index on (a,b) is better</li>
<li>In case you're using a &lt;/&gt;, b &lt;/&gt; &#8211; both searches should be done using index, but, given results from t3/t4 test above &#8211; I would put first the column that has better selectivity</li>
</ul>
<p>Hope it helps.</p>
<p><!-- vim: set spell spelllang=en_US ft=xhtml: --></p>

									</div>
			</div>
		</div>
			
		<div class="comm">
			
<!-- You can start editing here. -->

<div class="bobcomments">




	<ol class="commentlist">

	<li class="commenthead"><h3 id="comments">7 comments <a href='http://www.depesz.com/2013/01/28/index-on-ab-vs-ba/feed/'><div class="rss-img"></div></a></h3></li>
	
			
<li class="odd" id="comment-37177" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-37177" title="">#</a></span> Capt. Obvious</div>  <div class="date">Jan 28, 2013</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>What about if both (a,b) and (b,a) indexes exist? Will PostgreSQL use both in a single query or prefer to scan just one index or is this choice dependent on index scan cost?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-37178" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-37178" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jan 28, 2013</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Capt.:<br />
PostgreSQL has the capability to use two indexes in single query, but I don&#8217;t see any scenario where using them both would be beneficial (over single index usage). As for test &#8211; sure, I can make it &#8211; just tell me what data distribution you&#8217;re curious about, because I just don&#8217;t see it.</p>
	</li>
		
		
			
<li class="odd" id="comment-37185" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-37185" title="">#</a></span> Capt. Obvious</div>  <div class="date">Jan 28, 2013</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>I am curious about what choices the planner will make when faced with the above distributions and both (a,b) and (b,a) indexes are available and how this choice is affected by index scan cost.</p>
	</li>
		
		
			
<li class="odd" id="comment-37298" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-37298" title="">#</a></span> Emanuel</div>  <div class="date">Jan 29, 2013</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>Brief: order the columns in the index accordingly to the selectivity (Better goes to the left).</p>
<p>Pretty nice hack Depesz! Hope see you at FOSDEM.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-37375" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-37375" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jan 30, 2013</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Emanuel:<br />
generally your brief is OK, unless your less-selective column is used for &#8220;=&#8221;, and the more selective from >/=/<=.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-37379" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-37379" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jan 30, 2013</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Capt.:<br />
Well, it&#8217;s simple to check. So:</p>
<p>1. for random distribution (1st case), and search for inequality/inequality, Pg uses single index.<br />
2. for the 2nd cast (t3 table), it&#8217;s using index on (a,b), ignoring (b,a)<br />
3. for 3rd case (t5 table): it uses, quite surprisingly, index on (b,a) (b is much less selective).</p>
	</li>
		
		
			
<li class="odd" id="comment-37391" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-37391" title="">#</a></span> MarcinP</div>  <div class="date">Jan 31, 2013</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/c2f3ee0608bbbc215f8433d22108fba8?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>There is a very nice website/book about using indices. Have a look at <a href="http://use-the-index-luke.com/" rel="nofollow">http://use-the-index-luke.com/</a> if you already have not known it.</p>
	</li>
		
		
		
	</ol>
	
	
	

	
	
	<form action="http://www.depesz.com/wp-comments-post.php" method="post" id="commentform">

	<h2 id="respond">Leave a comment</h2>

		
	
		<label for="author">Name</label>
		<input type="text" name="author" id="author" value="" size="22" tabindex="2" />
				
		<label for="email">E-mail</label>
		<input type="text" name="email" id="email" value="" tabindex="3" size="22" />		
		
		<label for="url">Website</label>
		<input type="text" name="url" id="url" value="" size="22" tabindex="4" />
	
	
		<label for="text">Your text</label>
		<textarea name="comment" id="comment" cols="5" rows="10" tabindex="5"></textarea>

		<input name="submit" type="submit" id="submit" tabindex="6" value="Submit comment" />
		<input type="hidden" name="comment_post_ID" value="2594" />
	
	<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="8a7cc7e2b3" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="142"/></p>
	</form>


</div>
		</div>
	
	
	</div>
<div id="sidebar">
<div class="rsidebar">
		<ul>
			<li id="search-3" class="widget widget_search"><h2 class="widgettitle">Search</h2>
<form method="get" id="searchform" action="http://www.depesz.com/">
<input name="s" id="s" type="text" value="Write your text. Press the button!" onfocus="if (this.value == 'Write your text. Press the button!') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Write your text. Press the button!';}" tabindex="1"/>
<input type="submit" id="searchsubmit" value="" />
</form>
<br /><br />
<div id="podzialka"></div></li>
<li id="linkcat-659" class="widget widget_links"><h2 class="widgettitle">Follow me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.depesz.com/comments/feed/">Comments RSS</a></li>
<li><a href="http://depesz.com/feed/">Posts RSS</a></li>

	</ul>
</li>


<!-- Wordpress Popular Posts Plugin v3.0.3 [W] [weekly] [views] [regular] -->
<li id="wpp-3" class="widget popular-posts">
<h2 class="widgettitle">Popular Posts</h2>

<ul class="wpp-list">
<li><a href="http://www.depesz.com/2014/07/14/waiting-for-9-5-implement-import-foreign-schema/" title="Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA." class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA.</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">334 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/07/15/waiting-for-9-5-psql-show-tablespace-size-in-db/" title="Waiting for 9.5 &#8211; psql: Show tablespace size in \db+" class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; psql: Show tablespace size in \db+</a>  <span class="post-stats"><span class="wpp-comments">1 comment</span> | <span class="wpp-views">309 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/10/why-is-upsert-so-complicated/" title="Why is UPSERT so complicated?" class="wpp-post-title" target="_self">Why is UPSERT so complicated?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">249 views</span></span> </li>
<li><a href="http://www.depesz.com/2010/03/02/charx-vs-varcharx-vs-varchar-vs-text/" title="CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03" class="wpp-post-title" target="_self">CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">197 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/05/06/understanding-postgresql-conf-log/" title="Understanding postgresql.conf : log*" class="wpp-post-title" target="_self">Understanding postgresql.conf : log*</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">150 views</span></span> </li>
<li><a href="http://www.depesz.com/2008/05/05/error-operator-does-not-exist-integer-text-how-to-fix-it/" title="&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?" class="wpp-post-title" target="_self">&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">140 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/01/29/getting-count-of-distinct-elements-per-group-in-postgresql/" title="Getting count of distinct elements, per group, in PostgreSQL." class="wpp-post-title" target="_self">Getting count of distinct elements, per group, in PostgreSQL.</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">126 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/09/how-much-ram-is-postgresql-using/" title="How much RAM is PostgreSQL using?" class="wpp-post-title" target="_self">How much RAM is PostgreSQL using?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">124 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/07/14/write-ahead-log-understanding-postgresql-conf-checkpoint_segments-checkpoint_timeout-checkpoint_warning/" title="Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning" class="wpp-post-title" target="_self">Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">123 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/11/14/how-i-learned-to-stop-worrying-and-love-the-triggers/" title="How I Learned to Stop Worrying and Love the Triggers" class="wpp-post-title" target="_self">How I Learned to Stop Worrying and Love the Triggers</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">98 views</span></span> </li>

</ul>
</li>

<!-- End Wordpress Popular Posts Plugin v3.0.3 -->
<li id="linkcat-4" class="widget widget_links"><h2 class="widgettitle">postgresql</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.postgresql.org/docs/current/interactive/index.html">Documentation</a></li>
<li><a href="http://explain.depesz.com/">Explain Analyze analyzer</a></li>
<li><a href="irc://irc.freenode.net/#postgresql">IRC help channel</a></li>
<li><a href="http://archives.postgresql.org/">Mailing Lists search</a></li>
<li><a href="http://planet.postgresql.org/">PG Planet</a></li>
<li><a href="http://www.postgresql.org/" title="strona domowa postgresqla">PostgreSQL Home Page</a></li>

	</ul>
</li>

<li id="linkcat-376" class="widget widget_links"><h2 class="widgettitle">About me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://search.cpan.org/~depesz/">CPAN</a></li>
<li><a href="https://github.com/depesz/">GitHub</a></li>
<li><a href="http://linkedin.com/in/depesz">Linked In</a></li>
<li><a href="http://www.depesz.com/toyota-gt86/">Samochd</a></li>

	</ul>
</li>

<li id="theme-switcher" class="widget widget_themeswitcher"><h2 class="widgettitle">Theme</h2>
<ul id="themeswitcher">
<li>
       <select style="width:140px" name="themeswitcher" onchange="location.href='http://www.depesz.com/index.php?wptheme=' + this.options[this.selectedIndex].value;">
               <option value="AS 400">AS 400</option>
               <option value="GrayGA">GrayGA</option>
               <option value="Twenty Eleven">Twenty Eleven</option>
               <option value="Twenty Fourteen">Twenty Fourteen</option>
               <option value="Twenty Ten">Twenty Ten</option>
               <option value="Twenty Thirteen">Twenty Thirteen</option>
               <option value="Twenty Twelve">Twenty Twelve</option>
               <option value="WordPress Classic">WordPress Classic</option>
               <option value="WordPress Default">WordPress Default</option>
               <option value="Wordpress Depesz" selected="selected">Wordpress Depesz</option>
       </select>
</li>
</ul></li>
		</ul>
</div>
		
</div>



<div id="space"></div>
</div>
<div id="bottom">
	<div class="navigation">			
					</div>
</div>

<!-- Powered by WPtouch: 3.4.4 --><script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script>
</div>

</body>
</html>

