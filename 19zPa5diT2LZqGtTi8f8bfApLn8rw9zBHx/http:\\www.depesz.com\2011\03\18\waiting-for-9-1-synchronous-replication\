http://www.depesz.com/2011/03/18/waiting-for-9-1-synchronous-replication/
HTTP/1.1 200 OK
Server: nginx
Date: Tue, 22 Jul 2014 11:21:26 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/5.5.12-1
X-Pingback: http://www.depesz.com/xmlrpc.php
Link: <http://www.depesz.com/?p=2140>; rel=shortlink

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="coder" content="MHweb.pl" />
<title>select * from depesz;  &raquo; Blog Archive   &raquo; Waiting for 9.1 &#8211; Synchronous replication</title>
<meta name="generator" content="WordPress 3.9.1" /> <!-- leave this for stats -->
<link rel="stylesheet" href="http://www.depesz.com/wp-content/themes/depesz/style.css" type="text/css" media="screen" />
<!-- <link rel="stylesheet" href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/style1.css" type="text/css" media="screen" /> -->

<link rel="alternate" type="application/rss+xml" title="select * from depesz; RSS Feed" href="http://www.depesz.com/feed/" />
<link rel="pingback" href="http://www.depesz.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="select * from depesz; &raquo; Waiting for 9.1 &#8211; Synchronous replication Comments Feed" href="http://www.depesz.com/2011/03/18/waiting-for-9-1-synchronous-replication/feed/" />
<link rel='stylesheet' id='cookie-style-css'  href='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.css?ver=3.9.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.depesz.com/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.depesz.com/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.0.3' type='text/css' media='all' />
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://www.depesz.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var user_options = {"messageContent":"In order for this site to work properly, and in order to evaluate and improve the site we need to store small files (called cookies) on your computer.<br\/> Over 90% of all websites do this, however, since the 25th of May 2011 we are required by EU regulations to obtain your consent first. What do you say?","redirectLink":"http:\/\/google.com","okText":"That's fine","notOkText":"I don't agree","cookieName":"jsCookiewarning29Check","ajaxUrl":"http:\/\/www.depesz.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/cookie-warning/cookiewarning.js?ver=3.9.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.depesz.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.depesz.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://www.depesz.com/2011/03/18/waiting-for-9-1-synchronous-replication/' />
<link rel='shortlink' href='http://www.depesz.com/?p=2140' />

<link rel="stylesheet" href="http://www.depesz.com/wp-content/plugins/dd-formmailer/dd-formmailer.css" type="text/css" media="screen" />
<style type="text/css">

</style>
<!--[if lte IE 7]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie.css" rel="stylesheet" type="text/css" /><![endif]-->
<!--[if lte IE 6]><link href="http://mhweb.pl/work/wp/wp-content/themes/blue-box/ie6.css" rel="stylesheet" type="text/css" /><![endif]-->
</head>
<body>
<div id="box">
	<div id="up">
		<div id="logo"></div>
		<div id="menu">

			<div class="lc"></div>
			
			<div class="main">
				<div id="nav">
					<ul class="nav">
					<li class="first"><a href="http://www.depesz.com">Blog</a></li>
					<li class="page_item page-item-1947"><a href="http://www.depesz.com/projects/">Projects</a></li>
<li class="page_item page-item-1618"><a href="http://www.depesz.com/contact/">Contact</a></li>
					</ul>
				</div>
			</div>

			<div class="rc"></div>

		</div>
	</div>

	<div id="top_cont"></div>
	<div id="mainbck">



	<div id="content">

	
		<div class="entry">
			<div class="post" id="post-2140">
				<div class="topek">
					<div class="name">
						<a href="http://www.depesz.com/2011/03/18/waiting-for-9-1-synchronous-replication/" rel="bookmark" title="Permanent Link to Waiting for 9.1 &#8211; Synchronous replication">Waiting for 9.1 &#8211; Synchronous replication</a><div class="rss-img"><a href="http://www.depesz.com/feed/">&nbsp;&nbsp;</a></div>
					</div>

					<small>March 18th, 2011 by depesz | Tags: <a href="http://www.depesz.com/tag/pg91/" rel="tag">pg91</a>, <a href="http://www.depesz.com/tag/pg_stat_replication/" rel="tag">pg_stat_replication</a>, <a href="http://www.depesz.com/tag/postgresql/" rel="tag">postgresql</a>, <a href="http://www.depesz.com/tag/replication/" rel="tag">replication</a>, <a href="http://www.depesz.com/tag/sr/" rel="tag">sr</a>, <a href="http://www.depesz.com/tag/streaming/" rel="tag">streaming</a>, <a href="http://www.depesz.com/tag/sync/" rel="tag">sync</a>, <a href="http://www.depesz.com/tag/synchronous/" rel="tag">synchronous</a> |  <a href="http://www.depesz.com/2011/03/18/waiting-for-9-1-synchronous-replication/#comments" title="Comment on Waiting for 9.1 &#8211; Synchronous replication">26 comments &#187;</a></small>
<br><small><big>Did it help? If yes - maybe you can help me? Donate BTC to <a href="https://blockchain.info/address/19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx">19zPa5diT2LZqGtTi8f8bfApLn8rw9zBHx</a></big></small>
				</div>
				
				<div class="the">
					<p>On 6th of March, Simon Riggs <a href="http://archives.postgresql.org/pgsql-committers/2011-03/msg00056.php">committed</a> patch:</p>
<p><code>Efficient transaction-controlled synchronous replication.<br />
If a standby is broadcasting reply messages and we have named<br />
one or more standbys in synchronous_standby_names then allow<br />
users who set synchronous_replication to wait for commit, which<br />
then provides strict data integrity guarantees. Design avoids<br />
sending and receiving transaction state information so minimises<br />
bookkeeping overheads. We synchronize with the highest priority<br />
standby that is connected and ready to synchronize. Other standbys<br />
can be defined to takeover in case of standby failure.<br />
&nbsp;<br />
This version has very strict behaviour; more relaxed options<br />
may be added at a later date.<br />
&nbsp;<br />
Simon Riggs and Fujii Masao, with reviews by Yeb Havinga, Jaime<br />
Casanova, Heikki Linnakangas and Robert Haas, plus the assistance<br />
of many other design reviewers.</code></p>
<p><span id="more-2140"></span></p>
<p>Before I will go into details, let's first define what synchronous replication is, and what it's not.</p>
<p>It is:</p>
<ul>
<li>solution that prevents loss of data in case of failure of master database server</li>
</ul>
<p>and it is not:</p>
<ul>
<li>solution for load balancing</li>
<li>solution for having multiple masters</li>
</ul>
<p>What's important &#8211; using synchronous replication is <b>slower</b> than not using it. So you should be really willing to take the cost for benefits.</p>
<p>As for benefits.</p>
<p>Virtually all replication systems we have now are so called asynchronous. That is &#8211; when data is written to master, after some time, it will appear on slave(s). Usually the time is short, but it is not impossible to have asynchronous replication with lag time of hours.</p>
<p>This situation (replication lag) has one drawback. When data is committed on master, and immediately the master will be &#8220;killed" there is no warranty that the data will be on slave(s). Generally lag time of &#8220;x" means that we are ok with loosing data that was committed in this &#8220;x" time.</p>
<p>Of course replication system do guarantee consistency, but data loss can happen.</p>
<p>Synchronous replication is solution for those cases where data loss cannot happen.</p>
<p>To understand how it works you have to understand <a href="http://www.depesz.com/index.php/2010/02/01/waiting-for-9-0-streaming-replication/">streaming replication</a>.</p>
<p>With streaming replication, as soon as data is written to WAL segment, it is also sent to all attached slave systems.</p>
<p>Synchronous replication modifies this setup in such a way that given transaction can request that &#8220;when I commit, I want to be sure that wal data has been sent to slave, and it confirmed that it got it".</p>
<p>Please note that I mentioned &#8220;given transaction". Setting whether you will be using normal streaming replication (asynchronous) or its synchronous variant is set by transaction. Of course you can set your default to always do synchronous replication, but it can be modified on per-transaction basis.</p>
<p>Thanks to this you can have slower, but more failproof handling of critical data, and faster, but not as safe modifying of data that is not that important.</p>
<p>So. How to set it up.</p>
<p>To playtest, I will need 3 Pg instances. Master and 2 slaves. So:</p>
<p>First, need to prepare my playground, so:</p>
<p><code>sh&gt; mkdir /var/tmp/depesz<br />
sh&gt; cd /var/tmp/depesz/<br />
sh&gt; mkdir -m 700 master<br />
sh&gt; initdb -D master/ -E UTF8<br />
sh&gt; echo "host replication all 127.0.0.1/32 trust" &gt;&gt; master/pg_hba.conf<br />
sh&gt; vim master/postgresql.conf</code></p>
<p>In postgresql.conf, I set following parameters:</p>
<ul>
<li><b>listen_addresses</b> =&gt; *</li>
<li><b>port</b> =&gt; 4001</li>
<li><b>logging_collector</b> =&gt; on</li>
<li><b>wal_level</b> =&gt; hot_standby</li>
<li><b>synchronous_standby_names</b> =&gt; *</li>
<li><b>max_wal_senders</b> =&gt; 5</li>
<li><b>wal_keep_segments</b> =&gt; 50</li>
<li><b>archive_mode </b> =&gt; on</li>
<li><b>archive_command </b> =&gt; &#8216;/bin/true'</li>
</ul>
<p>Afterwards:</p>
<p><code>sh&gt; pg_ctl -D master/ start</code></p>
<p>And I have my test master server ready. For replication, I'll use special user:</p>
<p><code>sh&gt; psql -p 4001 -d postgres -c &quot;create user replication with replication&quot;</code></p>
<p>all done.</p>
<p>So, let's make the slaves:</p>
<p><code>sh&gt; psql -p 4001 -d postgres -c &quot;select pg_start_backup('x')&quot;<br />
sh&gt; rsync -a master/ slave1/<br />
sh&gt; rsync -a master/ slave2/<br />
sh&gt; psql -p 4001 -d postgres -c &quot;select pg_stop_backup()&quot;<br />
sh&gt; rm slave{1,2}/postmaster.pid slave{1,2}/pg_xlog/0* slave{1,2}/pg_xlog/archive_status/* slave{1,2}/pg_log/*<br />
sh&gt; vim -o slave{1,2}/postgresql.conf</code></p>
<p>In those configs, I change port number to 4011 for slave1 and 4021 for slave2, and enable hot_standby (hot_standby = on).</p>
<p>Finally, in both slaves, I create file recovery.conf with the same content:</p>
<p><code>restore_command = '/bin/false'<br />
standby_mode = 'on'<br />
primary_conninfo = 'port=4001 host=127.0.0.1 user=replication'</code></p>
<p>Afterwards I start both slaves:</p>
<p><code>sh&gt; pg_ctl -D slave1/ start<br />
sh&gt; pg_ctl -D slave2/ start</code></p>
<p>And, I can verify that it all works:</p>
<p><code>sh&gt; paste -d, {master,slave{1,2}}/postmaster.pid | head -n 1 | xargs -I{} ps uwf --ppid {} --pid {}<br />
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<br />
depesz   15504  0.0  0.0  58864  6212 pts/3    S    12:58   0:00 /home/pgdba/work/bin/postgres -D slave2<br />
depesz   15505  0.0  0.0  25096   688 ?        Ss   12:58   0:00  \_ postgres: logger process<br />
depesz   15506  0.0  0.0  58932  1412 ?        Ss   12:58   0:00  \_ postgres: startup process   recovering 00000001000000000000000A<br />
depesz   15509  0.0  0.0  75916  4112 ?        Ss   12:58   0:00  \_ postgres: wal receiver process   streaming 0/A0000B0<br />
depesz   15511  0.0  0.0  58864  1012 ?        Ss   12:58   0:00  \_ postgres: writer process<br />
depesz   15512  0.0  0.0  27192   896 ?        Ss   12:58   0:00  \_ postgres: stats collector process<br />
depesz   15490  0.0  0.0  58868  6208 pts/3    S    12:58   0:00 /home/pgdba/work/bin/postgres -D slave1<br />
depesz   15491  0.0  0.0  25100   688 ?        Ss   12:58   0:00  \_ postgres: logger process<br />
depesz   15492  0.0  0.0  58936  1408 ?        Ss   12:58   0:00  \_ postgres: startup process   recovering 00000001000000000000000A<br />
depesz   15495  0.0  0.0  75920  4108 ?        Ss   12:58   0:00  \_ postgres: wal receiver process   streaming 0/A0000B0<br />
depesz   15497  0.0  0.0  58868  1008 ?        Ss   12:58   0:00  \_ postgres: writer process<br />
depesz   15498  0.0  0.0  27196   892 ?        Ss   12:58   0:00  \_ postgres: stats collector process<br />
depesz   14832  0.0  0.0  58840  6256 pts/6    S    12:51   0:00 /home/pgdba/work/bin/postgres -D master<br />
depesz   14833  0.0  0.0  25104   688 ?        Ss   12:51   0:00  \_ postgres: logger process<br />
depesz   14835  0.0  0.0  58948  1688 ?        Ss   12:51   0:00  \_ postgres: writer process<br />
depesz   14836  0.0  0.0  58840  1008 ?        Ss   12:51   0:00  \_ postgres: wal writer process<br />
depesz   14837  0.0  0.0  59700  2112 ?        Ss   12:51   0:00  \_ postgres: autovacuum launcher process<br />
depesz   14838  0.0  0.0  27200   860 ?        Ss   12:51   0:00  \_ postgres: archiver process   last was 000000010000000000000009.00000020.backup<br />
depesz   14839  0.0  0.0  27200  1020 ?        Ss   12:51   0:00  \_ postgres: stats collector process<br />
depesz   15496  0.0  0.0  59676  2468 ?        Ss   12:58   0:00  \_ postgres: wal sender process replication 127.0.0.1(37690) streaming 0/A0000B0<br />
depesz   15510  0.0  0.0  59676  2468 ?        Ss   12:58   0:00  \_ postgres: wal sender process replication 127.0.0.1(37691) streaming 0/A0000B0</code></p>
<p>As we can see both slaves did connect to master as streaming replication slaves, and are up to date.</p>
<p>Nice. So, first test is to see if we can notice the &#8220;missing data on slave" problem. To do it, I'll simply insert now() to some test table to master, and immediately check slaves:</p>
<p><code>sh&gt; psql -p 4001 -d postgres -c &quot;create table test (x timestamptz primary key)&quot;<br />
sh&gt; for i in {1..10}<br />
sh&gt; do<br />
sh&gt;     echo &quot;Test #$i:&quot;<br />
sh&gt;     psql -qAtX -p 4001 -d postgres -c &quot;insert into test (x) values (now()) returning x&quot;<br />
sh&gt;     psql -qAtX -p 4011 -d postgres -c &quot;select max(x) from test&quot;<br />
sh&gt;     psql -qAtX -p 4021 -d postgres -c &quot;select max(x) from test&quot;<br />
sh&gt;     echo<br />
sh&gt; done</code></p>
<p>This test, does the insert-returning, and select max() from both slaves 10 times in a row, when ran, it showed me:</p>
<p><code>Test #1:<br />
2011-03-18 13:06:26.399963+01<br />
&nbsp;<br />
&nbsp;<br />
&nbsp;<br />
Test #2:<br />
2011-03-18 13:06:26.420898+01<br />
2011-03-18 13:06:26.399963+01<br />
2011-03-18 13:06:26.399963+01<br />
&nbsp;<br />
Test #3:<br />
2011-03-18 13:06:26.434145+01<br />
2011-03-18 13:06:26.420898+01<br />
2011-03-18 13:06:26.420898+01<br />
&nbsp;<br />
Test #4:<br />
2011-03-18 13:06:26.452543+01<br />
2011-03-18 13:06:26.434145+01<br />
2011-03-18 13:06:26.434145+01<br />
&nbsp;<br />
Test #5:<br />
2011-03-18 13:06:26.470355+01<br />
2011-03-18 13:06:26.452543+01<br />
2011-03-18 13:06:26.452543+01<br />
&nbsp;<br />
Test #6:<br />
2011-03-18 13:06:26.488227+01<br />
2011-03-18 13:06:26.470355+01<br />
2011-03-18 13:06:26.470355+01<br />
&nbsp;<br />
Test #7:<br />
2011-03-18 13:06:26.506338+01<br />
2011-03-18 13:06:26.488227+01<br />
2011-03-18 13:06:26.488227+01<br />
&nbsp;<br />
Test #8:<br />
2011-03-18 13:06:26.524422+01<br />
2011-03-18 13:06:26.506338+01<br />
2011-03-18 13:06:26.506338+01<br />
&nbsp;<br />
Test #9:<br />
2011-03-18 13:06:26.542727+01<br />
2011-03-18 13:06:26.524422+01<br />
2011-03-18 13:06:26.524422+01<br />
&nbsp;<br />
Test #10:<br />
2011-03-18 13:06:26.56041+01<br />
2011-03-18 13:06:26.542727+01<br />
2011-03-18 13:06:26.542727+01</code></p>
<p>Interesting. At <b>no</b> times slaves showed the same value as master.</p>
<p>But now, let's repeat it, but first change the master query from</p>
<p><code>insert into test (x) values (now()) returning x</code></p>
<p>to</p>
<p><code>set synchronous_replication = on; insert into test (x) values (now()) returning x</code></p>
<p>Results:</p>
<p><code>Test #1:<br />
2011-03-18 13:10:15.920473+01<br />
2011-03-18 13:10:15.920473+01<br />
2011-03-18 13:10:15.920473+01<br />
&nbsp;<br />
Test #2:<br />
2011-03-18 13:10:15.958886+01<br />
2011-03-18 13:10:15.958886+01<br />
2011-03-18 13:10:15.958886+01<br />
&nbsp;<br />
Test #3:<br />
2011-03-18 13:10:15.994531+01<br />
2011-03-18 13:10:15.994531+01<br />
2011-03-18 13:10:15.994531+01<br />
&nbsp;<br />
Test #4:<br />
2011-03-18 13:10:16.030824+01<br />
2011-03-18 13:10:16.030824+01<br />
2011-03-18 13:10:16.030824+01<br />
&nbsp;<br />
Test #5:<br />
2011-03-18 13:10:16.066797+01<br />
2011-03-18 13:10:16.066797+01<br />
2011-03-18 13:10:16.066797+01<br />
&nbsp;<br />
Test #6:<br />
2011-03-18 13:10:16.102643+01<br />
2011-03-18 13:10:16.102643+01<br />
2011-03-18 13:10:16.102643+01<br />
&nbsp;<br />
Test #7:<br />
2011-03-18 13:10:16.138506+01<br />
2011-03-18 13:10:16.138506+01<br />
2011-03-18 13:10:16.138506+01<br />
&nbsp;<br />
Test #8:<br />
2011-03-18 13:10:16.174385+01<br />
2011-03-18 13:10:16.174385+01<br />
2011-03-18 13:10:16.174385+01<br />
&nbsp;<br />
Test #9:<br />
2011-03-18 13:10:16.210709+01<br />
2011-03-18 13:10:16.210709+01<br />
2011-03-18 13:10:16.210709+01<br />
&nbsp;<br />
Test #10:<br />
2011-03-18 13:10:16.246883+01<br />
2011-03-18 13:10:16.246883+01<br />
2011-03-18 13:10:16.246883+01</code></p>
<p>Whoa, that's great! All transactions (and since I didn't use begin/commit &#8211; all commands) will wait with finish till data is replicated.</p>
<p>There is just one small issue. Speed.</p>
<p>Let's redo the test, ignoring output, but checking how long it will take.</p>
<p>First, without synchronous_replication. 3 runs (each inserting 1000 rows, each row with separate insert). All 3 runs the same time &#8211; 1.8s.</p>
<p>Now, the same test, but first, I'll do this:</p>
<p><code>sh&gt; psql -d postgres -p 4001 -c &quot;alter database postgres set synchronous_replication = on&quot;</code></p>
<p>Thus effectively enforcing synchronous replication for all transactions (unless some transaction would explicitly disable it.</p>
<p>Again, 3 runs, each inserting 1000 rows. Times: 2.4s, 2.394s and 2.4s.</p>
<p>Please note that in my example, I have all 3 servers on the same server, so there is virtually no overhead of tcp/ip and network.</p>
<p>In certain cases it might be preferred to have more than 1 slave, but only 1 being synchronous. I.e. in my case &#8211; let's say that slave1 has to be synchronous, but slave2 &#8211; I don't care.</p>
<p>Thanks to synchronous_standby_names option, it's actually possible.</p>
<p>First, I need to make sure my slave servers will properly <i>introduce</i> themselves. I do it by changing primary_conninfo in their recovery.conf files to:</p>
<p><code>slave1/recovery.conf:primary_conninfo = 'port=4001 host=127.0.0.1 user=replication application_name=slave1'<br />
slave2/recovery.conf:primary_conninfo = 'port=4001 host=127.0.0.1 user=replication application_name=slave2'</code></p>
<p>I.e. the change is addition of application_name parameter.</p>
<p>After slaves restart, I can verify on master, that the names are now properly seen by replication system:</p>
<p><code>sh&gt; psql -p 4001 -d postgres -c &quot;select procpid, application_name, state from pg_stat_replication&quot;<br />
 procpid | application_name |   state<br />
---------+------------------+-----------<br />
   22196 | slave1           | STREAMING<br />
   22219 | slave2           | STREAMING<br />
(2 rows)</code></p>
<p>Now, in masters postgresql.conf, I change synchronous_standby_names from &#8216;*' to &#8216;slave1&#8242;:</p>
<p><code>sh&gt; psql -p 4001 -d postgres -c &quot;show synchronous_standby_names&quot;<br />
 synchronous_standby_names<br />
---------------------------<br />
 slave1<br />
(1 row)</code></p>
<p>So, let's repeat now the test with inserts and selects in synchronous mode:</p>
<p><code>sh&gt; for i in {1..10}<br />
sh&gt; do<br />
sh&gt;     echo &quot;Test #$i:&quot;<br />
sh&gt;     psql -qAtX -p 4001 -d postgres -c &quot;set synchronous_replication = on<br />
sh&gt;     insert into test (x) values (now()) returning x&quot;<br />
sh&gt;     psql -qAtX -p 4021 -d postgres -c &quot;select max(x) from test&quot;<br />
sh&gt;     psql -qAtX -p 4011 -d postgres -c &quot;select max(x) from test&quot;<br />
sh&gt;     echo<br />
sh&gt; done</code></p>
<p>Results:</p>
<p><code>Test #1:<br />
2011-03-18 14:04:30.973902+01<br />
2011-03-18 14:04:30.973902+01<br />
2011-03-18 14:04:30.973902+01<br />
&nbsp;<br />
Test #2:<br />
2011-03-18 14:04:31.013951+01<br />
2011-03-18 14:04:31.013951+01<br />
2011-03-18 14:04:31.013951+01<br />
&nbsp;<br />
Test #3:<br />
2011-03-18 14:04:31.06333+01<br />
2011-03-18 14:04:31.06333+01<br />
2011-03-18 14:04:31.06333+01<br />
&nbsp;<br />
Test #4:<br />
2011-03-18 14:04:31.099386+01<br />
2011-03-18 14:04:31.099386+01<br />
2011-03-18 14:04:31.099386+01<br />
&nbsp;<br />
Test #5:<br />
2011-03-18 14:04:31.134893+01<br />
2011-03-18 14:04:31.134893+01<br />
2011-03-18 14:04:31.134893+01<br />
&nbsp;<br />
Test #6:<br />
2011-03-18 14:04:31.171247+01<br />
2011-03-18 14:04:31.171247+01<br />
2011-03-18 14:04:31.171247+01<br />
&nbsp;<br />
Test #7:<br />
2011-03-18 14:04:31.207192+01<br />
2011-03-18 14:04:31.171247+01<br />
2011-03-18 14:04:31.207192+01<br />
&nbsp;<br />
Test #8:<br />
2011-03-18 14:04:31.236442+01<br />
2011-03-18 14:04:31.236442+01<br />
2011-03-18 14:04:31.236442+01<br />
&nbsp;<br />
Test #9:<br />
2011-03-18 14:04:31.27299+01<br />
2011-03-18 14:04:31.27299+01<br />
2011-03-18 14:04:31.27299+01<br />
&nbsp;<br />
Test #10:<br />
2011-03-18 14:04:31.309419+01<br />
2011-03-18 14:04:31.309419+01<br />
2011-03-18 14:04:31.309419+01</code></p>
<p>Please note that:</p>
<ul>
<li>I query slave2 (-p 4021) first, and slave1 second (this is because I'm testing it all on single host, and the network lag is 0, so I can't show it nicely otherwise)</li>
<li>Results for test #7</li>
</ul>
<p>Usually both slaves get the same data, but sometimes, the one that is not listed in synchronous_standby_names will be visibly lagged.</p>
<p>There is one important problem though.</p>
<p>If none of your listed synchronous_standby_names slave servers is available (which includes case where synchronous_standby_names is &#8216;*' and all slaves are unavailable) all your synchronous transactions will hang.</p>
<p>This is by design, as they have to wait for confirmation from slaves, and if the slaves are not available &#8211; they can't confirm.</p>
<p>All in all &#8211; it's a great feature, that many have been waiting for.</p>

									</div>
			</div>
		</div>
			
		<div class="comm">
			
<!-- You can start editing here. -->

<div class="bobcomments">




	<ol class="commentlist">

	<li class="commenthead"><h3 id="comments">26 comments <a href='http://www.depesz.com/2011/03/18/waiting-for-9-1-synchronous-replication/feed/'><div class="rss-img"></div></a></h3></li>
	
			
<li class="odd" id="comment-33282" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33282" title="">#</a></span> <a href='http://blog.hagander.net/' rel='external nofollow' class='url'>Magnus Hagander</a></div>  <div class="date">Mar 18, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/b7392866594d385dae024f6c7c9e896a?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Any particular reason you&#8217;re not using pg_basebackup to set up your slaves? Just wondering if we&#8217;re missing some critical feature you think is needed there <img src="http://www.depesz.com/wp-includes/images/smilies/icon_wink.gif" alt=";)" class="wp-smiley" /> </p>
	</li>
		
		
			
<li class="mycomment" id="comment-33283" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33283" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Mar 18, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Magnus:<br />
I&#8217;m just more used to rsync. Besides &#8211; it&#8217;s just 2 directories on the same machine, using pg_basebackup would be overkill <img src="http://www.depesz.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
	</li>
		
		
			
<li class="odd" id="comment-33284" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33284" title="">#</a></span> gj</div>  <div class="date">Mar 18, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/07a8b2ae31ca11464c23f375330e146a?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>great write up. Thanks <img src="http://www.depesz.com/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /> </p>
	</li>
		
		
			
<li class="odd" id="comment-33285" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33285" title="">#</a></span> <a href='http://rhaas.blogspot.com/' rel='external nofollow' class='url'>Robert Haas</a></div>  <div class="date">Mar 18, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>But wait a minute!</p>
<p>Synchronous replication does NOT guarantee that the change will be *visible* on the slave at the time the commit completes on the master.  It merely guarantees that the WAL will have been transferred to the slave and written durably to disk. It&#8217;s unsafe to rely on the assumption that it will have also been replayed.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-33286" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33286" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Mar 18, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Robert:<br />
Thanks for clarification. The distinction is pretty important.</p>
	</li>
		
		
			
<li class="odd" id="comment-33287" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33287" title="">#</a></span> Mark Lillywhite</div>  <div class="date">Mar 18, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>Hi, I&#8217;m curious about your comment regarding latency being lower because there is no TCP traffic in your example. But in your example there will instead be contention for CPU and disk, so wouldn&#8217;t it be quite possible that having separate machines for the slave might actually result in better performance despite having to marshal everything via TCP? I mean one would presumably be running gigabit Ethernet between the machines&#8230; Latency is pretty low, no?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-33288" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33288" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Mar 18, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Mark:<br />
usually, aside from test-environment, I don&#8217;t imagine anyone running master and slave on the same server, so there is no real comparison.</p>
	</li>
		
		
			
<li class="odd" id="comment-33593" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33593" title="">#</a></span> AJ</div>  <div class="date">Jun 7, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/4614cacfb6d704c217d768b2ddc41188?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>The commands on master are hanging:<br />
psql -p 4001 -d postgres -c &#8220;create user replication with replication&#8221;<br />
 psql -p 4001 -d postgres -c &#8220;select pg_start_backup(&#8216;x&#8217;)&#8221;</p>
<p>When I kill them, I get the message:</p>
<p>WARNING:  canceling wait for synchronous replication due to user request<br />
DETAIL:  The transaction has already committed locally, but may not have been replicated to the standby.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-33594" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33594" title="">#</a></span> <a href='http://depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jun 7, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@AJ:<br />
And? Perhaps you should ask on some mailing list, or even report a bug?</p>
	</li>
		
		
			
<li class="odd" id="comment-33595" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33595" title="">#</a></span> AJ</div>  <div class="date">Jun 7, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/4614cacfb6d704c217d768b2ddc41188?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@DEPESZ:<br />
Do you remember it hanging for you when you tried out the steps ?<br />
Maybe it is expected to hang as slave(s) is not up when these commands are executed.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-33600" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-33600" title="">#</a></span> <a href='http://depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jun 7, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>No, it didn&#8217;t hang for me.</p>
	</li>
		
		
			
<li class="odd" id="comment-34129" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34129" title="">#</a></span> dohan</div>  <div class="date">Sep 19, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/eb0ae78c0c5fad8888dfbd2fb8d5f0fa?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>What are the changes need to be done if I setup the slave1 in another machine?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34130" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34130" title="">#</a></span> <a href='http://depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Sep 19, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Dohan:<br />
hmm .. I thought it&#8217;s obvious. You need to add different IP in pg_hba.conf for replication, and change ip in primary_conninfo on slave.</p>
	</li>
		
		
			
<li class="odd" id="comment-34135" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34135" title="">#</a></span> dohan</div>  <div class="date">Sep 20, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/eb0ae78c0c5fad8888dfbd2fb8d5f0fa?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Ok tx I did it. Now I setup the cluster in three machines each having one pg instance. I am going to test the failover scenario. I used trigger_file setting to make a slave to accept read/writes when the master goes down. Currently only that setting not work because there is no slaves configured in the new master as old one. So it hangs at a INSERT. How can I deal with this? And how can I start old master safely as a slave without stopping current master?</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34136" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34136" title="">#</a></span> <a href='http://depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Sep 20, 2011</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Dohan:<br />
When you switched slave to become master, it&#8217;s basically standalone pg. So you have to setup replication from scratch, just the other way around.</p>
	</li>
		
		
			
<li class="odd" id="comment-34643" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34643" title="">#</a></span> LOU</div>  <div class="date">Dec 7, 2011</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>@# AJ<br />
the master can hang when the slave is in catchup mode after starting and cannot get the WAL file from the master pg_xlog or archive (00000001000000000000005C in this case)</p>
<p>postgres  9537  0.0  0.0 459548  1764 ?        Ss   15:28   0:00 postgres: startup process   waiting for 00000001000000000000005C</p>
<p>this results in an error entry in the current log in  pg_log</p>
	</li>
		
		
			
<li class="odd" id="comment-34765" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34765" title="">#</a></span> ManG</div>  <div class="date">Jan 11, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/7f0a00434a53aebecf2024d4ec42b212?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Thanks for an awesome article on getting PG sync replication setup and running in minutes.</p>
<p>Here are my questions.</p>
<p>1. I don&#8217;t think synchronous_replication variable is any more valid. At least PG 9.1.2 doesn&#8217;t have it. Synchronous_commit is on by default.</p>
<p>2. Can I have sync replication with standby &#8220;*&#8221; setup as above and master node run without any standby ?</p>
<p>3. I want to configure timeout so that if standby sync takes more than few seconds, master wants to break the sync and continue on its own.</p>
<p>Help me with the above.</p>
<p>thanks,<br />
ManG</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34766" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34766" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jan 11, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@Mang:<br />
1. yes. the synchronous_replication guc has been removed, and it&#8217;s logic is now in sunchronous_commit.</p>
<p>2. why don&#8217;t you just try it?</p>
<p>3. i don&#8217;t think it&#8217;s possible.</p>
	</li>
		
		
			
<li class="odd" id="comment-34769" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34769" title="">#</a></span> ManG</div>  <div class="date">Jan 13, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/7f0a00434a53aebecf2024d4ec42b212?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Hi,</p>
<p>I have a PG 9.1.2 Master  Slave with synchronous replication setup. They are all working fine as expected. I do have a case where I want to flip Master to non replication mode whenever its slave is not responding. I have set replication_timeout to 5s and whenever salve is not responding for for more than 5s, i see the master detecting it. But, the transactions on the master is stuck till the slave comes back. To get over it, I reloaded the config on master with synchronous_commit = local. Further transactions on the master are going thru fine with this local commits turned on.</p>
<p>Here are my questions:</p>
<p>1. Transaction which was stuck right when slave going away never went thru even after I reloaded master&#8217;s config with local commit on. I do see all new transactions on master are going thru fine, except the one which was stuck initially. How to get this stuck transaction complete or return with error.</p>
<p>2. Whenever there is a problem with slave, I have to manually reload master&#8217;s config with local commit turned on to get master go forward. Is there any automated way to reload this config with local commit on on slave&#8217;s unresponsiveness ? tcp connection timeouts, replication timeouts all detect the failures, but i want to run some corrective action on these failure detection.</p>
<p>your help is much appreciated.</p>
<p>thanks.</p>
	</li>
		
		
			
<li class="odd" id="comment-34778" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34778" title="">#</a></span> ManG</div>  <div class="date">Jan 16, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/7f0a00434a53aebecf2024d4ec42b212?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Hi Depesz,</p>
<p>your views on my question dated &#8216;Jan 13, 2012&#8242; please ? Any help would be much appreciated.</p>
<p>thanks,<br />
Manoj</p>
	</li>
		
		
			
<li class="mycomment" id="comment-34779" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-34779" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Jan 16, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@ManG: these were more of a &#8220;Support&#8221; questions. While it might look like, I don&#8217;t provide support for PostgreSQL on my blog. I might sometimes answer questions, but your questions are either impossible to answer without knowing a lot of details about your situation, or trivial to check on your own &#8211; so I don&#8217;t see much point in doing the check on my side, and providing you with ready answer &#8211; it&#8217;s a matter who puts effort into checking thing.</p>
	</li>
		
		
			
<li class="odd" id="comment-35420" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-35420" title="">#</a></span> JWolf</div>  <div class="date">Apr 16, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/b3f9afc0a714d180b92a9e94b95a4447?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>Our application is written in Java and uses standard JDBC driver API ( behind the scenes postgres jdbc provider) to connect to postgres.</p>
<p>I am wondering how to turn on and off synchronous_replication for some transactions only.<br />
This way I can have the replication enabled for some important tables and not for other tables.</p>
<p>Do you happen to know how to set this when using jdbc drivers synchronous_replication </p>
<p>In your example, I see that you are using psql to set the same. But wondering how to set this in the application that typically does not use psql.</p>
	</li>
		
		
			
<li class="mycomment" id="comment-35423" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-35423" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Apr 16, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@JWolf:</p>
<p>Well, SET &#8230; is just an sql query. So you can run it the same way you run any other query. No idea how that works in JDBC, but I don&#8217;t see why it would be different than (for example) calling update or delete.</p>
	</li>
		
		
			
<li class="odd" id="comment-35424" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-35424" title="">#</a></span> JWolf</div>  <div class="date">Apr 16, 2012</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>makes sense. Thanks,<br />
Any plans on writing a blog on horizontal shards using postgres</p>
	</li>
		
		
			
<li class="mycomment" id="comment-35425" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-35425" title="">#</a></span> <a href='http://www.depesz.com/' rel='external nofollow' class='url'>depesz</a></div>  <div class="date">Apr 16, 2012</div></div>
				<img alt='' src='http://1.gravatar.com/avatar/d5ecebb85919589a7cbf7f90eb34eacf?s=64&amp;d=identicon&amp;r=X' class='avatar avatar-64 photo' height='64' width='64' />		<p>@JWolf:<br />
hmnmm &#8230; like this one: <a href="http://www.depesz.com/2011/12/02/the-secret-ingredient-in-the-webscale-sauce/" rel="nofollow">http://www.depesz.com/2011/12/02/the-secret-ingredient-in-the-webscale-sauce/</a></p>
	</li>
		
		
			
<li class="odd" id="comment-35426" onMouseOver="this.style.background='#dcdcdc'" onMouseOut="this.style.background='#e9e9e9'">

		<div class="name"><div class="title"><span class="bu"><a href="#comment-35426" title="">#</a></span> JWolf</div>  <div class="date">Apr 17, 2012</div></div>
				<img alt='' src='http://0.gravatar.com/avatar/?d=identicon&amp;s=64' class='avatar avatar-64 photo avatar-default' height='64' width='64' />		<p>Thanks! nicely written. Your blogs are way cool!</p>
	</li>
		
		
		
	</ol>
	
	
	

	
	
	<form action="http://www.depesz.com/wp-comments-post.php" method="post" id="commentform">

	<h2 id="respond">Leave a comment</h2>

		
	
		<label for="author">Name</label>
		<input type="text" name="author" id="author" value="" size="22" tabindex="2" />
				
		<label for="email">E-mail</label>
		<input type="text" name="email" id="email" value="" tabindex="3" size="22" />		
		
		<label for="url">Website</label>
		<input type="text" name="url" id="url" value="" size="22" tabindex="4" />
	
	
		<label for="text">Your text</label>
		<textarea name="comment" id="comment" cols="5" rows="10" tabindex="5"></textarea>

		<input name="submit" type="submit" id="submit" tabindex="6" value="Submit comment" />
		<input type="hidden" name="comment_post_ID" value="2140" />
	
	<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="6623fe6667" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="85"/></p>
	</form>


</div>
		</div>
	
	
	</div>
<div id="sidebar">
<div class="rsidebar">
		<ul>
			<li id="search-3" class="widget widget_search"><h2 class="widgettitle">Search</h2>
<form method="get" id="searchform" action="http://www.depesz.com/">
<input name="s" id="s" type="text" value="Write your text. Press the button!" onfocus="if (this.value == 'Write your text. Press the button!') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Write your text. Press the button!';}" tabindex="1"/>
<input type="submit" id="searchsubmit" value="" />
</form>
<br /><br />
<div id="podzialka"></div></li>
<li id="linkcat-659" class="widget widget_links"><h2 class="widgettitle">Follow me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.depesz.com/comments/feed/">Comments RSS</a></li>
<li><a href="http://depesz.com/feed/">Posts RSS</a></li>

	</ul>
</li>


<!-- Wordpress Popular Posts Plugin v3.0.3 [W] [weekly] [views] [regular] -->
<li id="wpp-3" class="widget popular-posts">
<h2 class="widgettitle">Popular Posts</h2>

<ul class="wpp-list">
<li><a href="http://www.depesz.com/2014/07/14/waiting-for-9-5-implement-import-foreign-schema/" title="Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA." class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; Implement IMPORT FOREIGN SCHEMA.</a>  <span class="post-stats"><span class="wpp-comments">2 comments</span> | <span class="wpp-views">643 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/07/15/waiting-for-9-5-psql-show-tablespace-size-in-db/" title="Waiting for 9.5 &#8211; psql: Show tablespace size in \db+" class="wpp-post-title" target="_self">Waiting for 9.5 &#8211; psql: Show tablespace size in \db+</a>  <span class="post-stats"><span class="wpp-comments">4 comments</span> | <span class="wpp-views">617 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/10/why-is-upsert-so-complicated/" title="Why is UPSERT so complicated?" class="wpp-post-title" target="_self">Why is UPSERT so complicated?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">279 views</span></span> </li>
<li><a href="http://www.depesz.com/2010/03/02/charx-vs-varcharx-vs-varchar-vs-text/" title="CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03" class="wpp-post-title" target="_self">CHAR(x) vs. VARCHAR(x) vs. VARCHAR vs. TEXT &#8211; UPDATED 2010-03-03</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">214 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/05/06/understanding-postgresql-conf-log/" title="Understanding postgresql.conf : log*" class="wpp-post-title" target="_self">Understanding postgresql.conf : log*</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">151 views</span></span> </li>
<li><a href="http://www.depesz.com/2012/06/09/how-much-ram-is-postgresql-using/" title="How much RAM is PostgreSQL using?" class="wpp-post-title" target="_self">How much RAM is PostgreSQL using?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">146 views</span></span> </li>
<li><a href="http://www.depesz.com/2008/05/05/error-operator-does-not-exist-integer-text-how-to-fix-it/" title="&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?" class="wpp-post-title" target="_self">&#8220;ERROR:  operator does not exist: integer = text&#8221; how to fix it?</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">132 views</span></span> </li>
<li><a href="http://www.depesz.com/2014/01/29/getting-count-of-distinct-elements-per-group-in-postgresql/" title="Getting count of distinct elements, per group, in PostgreSQL." class="wpp-post-title" target="_self">Getting count of distinct elements, per group, in PostgreSQL.</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">131 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/07/14/write-ahead-log-understanding-postgresql-conf-checkpoint_segments-checkpoint_timeout-checkpoint_warning/" title="Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning" class="wpp-post-title" target="_self">Write Ahead Log + Understanding postgresql.conf: checkpoint_segments, checkpoint_timeout, checkpoint_warning</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">119 views</span></span> </li>
<li><a href="http://www.depesz.com/2011/03/07/waiting-for-9-1-foreach-in-array/" title="Waiting for 9.1 &#8211; FOREACH IN ARRAY" class="wpp-post-title" target="_self">Waiting for 9.1 &#8211; FOREACH IN ARRAY</a>  <span class="post-stats"><span class="wpp-comments">0 comments</span> | <span class="wpp-views">104 views</span></span> </li>

</ul>
</li>

<!-- End Wordpress Popular Posts Plugin v3.0.3 -->
<li id="linkcat-4" class="widget widget_links"><h2 class="widgettitle">postgresql</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.postgresql.org/docs/current/interactive/index.html">Documentation</a></li>
<li><a href="http://explain.depesz.com/">Explain Analyze analyzer</a></li>
<li><a href="irc://irc.freenode.net/#postgresql">IRC help channel</a></li>
<li><a href="http://archives.postgresql.org/">Mailing Lists search</a></li>
<li><a href="http://planet.postgresql.org/">PG Planet</a></li>
<li><a href="http://www.postgresql.org/" title="strona domowa postgresqla">PostgreSQL Home Page</a></li>

	</ul>
</li>

<li id="linkcat-376" class="widget widget_links"><h2 class="widgettitle">About me</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://search.cpan.org/~depesz/">CPAN</a></li>
<li><a href="https://github.com/depesz/">GitHub</a></li>
<li><a href="http://linkedin.com/in/depesz">Linked In</a></li>
<li><a href="http://www.depesz.com/toyota-gt86/">Samochd</a></li>

	</ul>
</li>

<li id="theme-switcher" class="widget widget_themeswitcher"><h2 class="widgettitle">Theme</h2>
<ul id="themeswitcher">
<li>
       <select style="width:140px" name="themeswitcher" onchange="location.href='http://www.depesz.com/index.php?wptheme=' + this.options[this.selectedIndex].value;">
               <option value="AS 400">AS 400</option>
               <option value="GrayGA">GrayGA</option>
               <option value="Twenty Eleven">Twenty Eleven</option>
               <option value="Twenty Fourteen">Twenty Fourteen</option>
               <option value="Twenty Ten">Twenty Ten</option>
               <option value="Twenty Thirteen">Twenty Thirteen</option>
               <option value="Twenty Twelve">Twenty Twelve</option>
               <option value="WordPress Classic">WordPress Classic</option>
               <option value="WordPress Default">WordPress Default</option>
               <option value="Wordpress Depesz" selected="selected">Wordpress Depesz</option>
       </select>
</li>
</ul></li>
		</ul>
</div>
		
</div>



<div id="space"></div>
</div>
<div id="bottom">
	<div class="navigation">			
					</div>
</div>

<!-- Powered by WPtouch: 3.4.4 --><script type='text/javascript' src='http://www.depesz.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script>
</div>

</body>
</html>

