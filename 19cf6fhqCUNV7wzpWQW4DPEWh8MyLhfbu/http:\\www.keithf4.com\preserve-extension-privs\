http://www.keithf4.com/preserve-extension-privs/
HTTP/1.0 200 OK
Date: Thu, 24 Jul 2014 12:58:33 GMT
Server: Apache/2.2.22 (Debian)
X-Powered-By: PHP/5.4.4-14+deb7u12
X-Pingback: http://www.keithf4.com/xmlrpc.php
Link: <http://www.keithf4.com/?p=263>; rel=shortlink
Vary: Accept-Encoding
Content-Encoding: gzip
Content-Length: 10165
Connection: close
Content-Type: text/html; charset=UTF-8

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<title>   PostgreSQL Extension Updates &amp; Preserving Privileges at Keith&#039;s Ramblings&#8230;</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="description" content="WARNING: If accidentally read, induce vomiting" />
<meta name="generator" content="WordPress 3.9.1" /> <!-- leave this for stats please -->
<link href="http://www.keithf4.com/wp-content/themes/journalist/style.css" rel="stylesheet" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Keith&#039;s Ramblings&#8230; RSS Feed" href="http://www.keithf4.com/feed/" />
<link rel="shortcut icon" type="image/x-png" href="http://www.keithf4.com/wp-content/themes/journalist/favicon.png" />
<link rel="pingback" href="http://www.keithf4.com/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="Keith&#039;s Ramblings... &raquo; PostgreSQL Extension Updates &amp; Preserving Privileges Comments Feed" href="http://www.keithf4.com/preserve-extension-privs/feed/" />
<link rel='stylesheet' id='crayon-css'  href='http://www.keithf4.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.6.5' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='http://www.keithf4.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=2.6.5' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://www.keithf4.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.6.5' type='text/css' media='all' />
<script type='text/javascript' src='http://www.keithf4.com/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://www.keithf4.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var quicktagsL10n = {"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","fullscreen":"fullscreen","toggleFullscreen":"Toggle fullscreen mode","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.keithf4.com/wp-includes/js/quicktags.min.js?ver=3.9.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.6.5","is_admin":"0","ajaxurl":"http:\/\/www.keithf4.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
var CrayonTagEditorSettings = {"home_url":"http:\/\/www.keithf4.com","css":"crayon-te","css_selected":"crayon-selected","code_css":"#crayon-code","url_css":"#crayon-url","url_info_css":"#crayon-te-url-info","lang_css":"#crayon-lang","title_css":"#crayon-title","mark_css":"#crayon-mark","range_css":"#crayon-range","inline_css":"crayon-inline","inline_hide_css":"crayon-hide-inline","inline_hide_only_css":"crayon-hide-inline-only","hl_css":"#crayon-highlight","switch_html":"#content-html","switch_tmce":"#content-tmce","tinymce_button_generic":".mce-btn","tinymce_button":"a.mce_crayon_tinymce,.mce-i-crayon_tinymce","tinymce_button_unique":"mce_crayon_tinymce","tinymce_highlight":"mce-active","submit_css":"#crayon-te-ok","cancel_css":"#crayon-te-cancel","content_css":"#crayon-te-content","dialog_title_css":"#crayon-te-title","submit_wrapper_css":"#crayon-te-submit-wrapper","data_value":"data-value","attr_sep":":","css_sep":"_","fallback_lang":"default","dialog_title_add":"Add Crayon Code","dialog_title_edit":"Edit Crayon Code","submit_add":"Add","submit_edit":"Save","bar":"#crayon-te-bar","bar_content":"#crayon-te-bar-content","extensions":{"scpt":"applescript","applescript":"applescript","swf":"as","fla":"as","cs":"c#","h":"c++","hh":"c++","hpp":"c++","hxx":"c++","h++":"c++","cc":"c++","cpp":"c++","cxx":"c++","c++":"c++","pas":"delphi","java":"java","class":"java","jar":"java","mv":"miva","mvc":"miva","mvt":"miva","m":"objc","mm":"objc","pl":"perl","py":"python","pyw":"python","pyc":"python","pyo":"python","pyd":"python","rb":"ruby","rbx":"ruby","rhtml":"ruby","vbs":"vb"}};
var CrayonSyntaxSettings = {"version":"2.6.5","is_admin":"0","ajaxurl":"http:\/\/www.keithf4.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.keithf4.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.te.min.js?ver=2.6.5'></script>
<script type='text/javascript' src='http://www.keithf4.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.7.3'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.keithf4.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.keithf4.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Mimeo &#8211; DML Replication' href='http://www.keithf4.com/mimeo-dml-replication/' />
<link rel='next' title='Mimeo &#8211; Repulling Incremental Replication Data' href='http://www.keithf4.com/mimeo-repulling-incremental-replication-data/' />
<meta name="generator" content="WordPress 3.9.1" />
<link rel='canonical' href='http://www.keithf4.com/preserve-extension-privs/' />
<link rel='shortlink' href='http://www.keithf4.com/?p=263' />
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<style type="text/css">.broken_link, a.broken_link {
	text-decoration: line-through;
}</style><!-- Google Analytics Tracking by Google Analyticator 6.4.7.3: http://www.videousermanuals.com/google-analyticator/ -->
<script type="text/javascript">
                var analyticsFileTypes = [''];
                            var analyticsSnippet = 'enabled';
                var analyticsEventTracking = 'enabled';
            </script>
<script type="text/javascript">
	var _gaq = _gaq || [];
  
	_gaq.push(['_setAccount', 'UA-28065688-1']);
    _gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</head>

<body>
<div id="container" class="group">

<h1><a href="http://www.keithf4.com/">Keith&#039;s Ramblings&#8230;</a></h1>
<div id="bubble"><p>WARNING: If accidentally read, induce vomiting</p></div> <!-- erase this line if you want to turn the bubble off -->

<div id="content" class="group">

<h2 id="post-263"><a href="http://www.keithf4.com/preserve-extension-privs/" rel="bookmark">PostgreSQL Extension Updates &#038; Preserving Privileges</a></h2>
<p class="comments"><a href="http://www.keithf4.com/preserve-extension-privs/#comments"><span class="dsq-postid" rel="263 http://www.keithf4.com/?p=263">with 2 comments</span></a></p>

<div class="main">
	<p>My latest update of <a href="https://github.com/omniti-labs/mimeo" target="_blank">Mimeo</a> required me to do something that I knew I would eventually need to do: drop and recreate a function in an extension without breaking the original privileges it had. If the code within a function changes, a CREATE OR REPLACE wouldn&#8217;t affect privileges. But when you need to change the parameters (not overload it) or return type of a function, it must be dropped and recreated.</p>
<p>Since extension updates are plain SQL, this is a little trickier than it would be if I could use variables or plpgsql to do this (like I did in the refresh_snap() function to preserve privileges when there are column changes that force a destination table recreation). I&#8217;d had an idea of how to do it, but until I actually tried it I wasn&#8217;t sure if it would work in the extension update process. This is some of the code from the beginning and end of the <a href="https://github.com/omniti-labs/mimeo/blob/master/updates/mimeo--0.11.1--0.12.0.sql" target="_blank">0.11.1 to 0.12.0</a> update of mimeo:</p><!-- Crayon Syntax Highlighter v2.6.5 -->

		<div id="crayon-53d102f9e971b183234581" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">PgSQL</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
CREATE TEMP TABLE mimeo_preserve_privs_temp (statement text);

INSERT INTO mimeo_preserve_privs_temp 
SELECT 'GRANT EXECUTE ON FUNCTION @extschema@.logdel_maker(text, int, text, boolean, text[], text, boolean, text[], text[], boolean) TO '||array_to_string(array_agg(grantee::text), ',')||';' 
FROM information_schema.routine_privileges
WHERE routine_schema = '@extschema@'
AND routine_name = 'logdel_maker'; 

INSERT INTO mimeo_preserve_privs_temp 
SELECT 'GRANT EXECUTE ON FUNCTION @extschema@.refresh_logdel(text, int, boolean, boolean) TO '||array_to_string(array_agg(grantee::text), ',')||';' 
FROM information_schema.routine_privileges
WHERE routine_schema = '@extschema@'
AND routine_name = 'refresh_logdel'; 

CREATE FUNCTION replay_preserved_privs() RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
v_row   record;
BEGIN
    FOR v_row IN SELECT statement FROM mimeo_preserve_privs_temp LOOP
        EXECUTE v_row.statement;
    END LOOP;
END
$$;

DROP FUNCTION @extschema@.logdel_maker(text, int, text, boolean, text[], text, boolean, text[], text[]);
DROP FUNCTION @extschema@.refresh_logdel(text, int, boolean);

[... Bunch of code that does the actual update here ...]

SELECT @extschema@.replay_preserved_privs();
DROP FUNCTION @extschema@.replay_preserved_privs();
DROP TABLE mimeo_preserve_privs_temp;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-2">2</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-4">4</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-6">6</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-8">8</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-10">10</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-12">12</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-14">14</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-16">16</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-18">18</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-20">20</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-22">22</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-24">24</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-26">26</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-28">28</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-30">30</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-32">32</div><div class="crayon-num" data-line="crayon-53d102f9e971b183234581-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e971b183234581-34">34</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53d102f9e971b183234581-1"><span class="crayon-st">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">TEMP</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span>mimeo_preserve_privs_temp<span class="crayon-h"> </span>(<span class="crayon-r">statement</span><span class="crayon-h"> </span><span class="crayon-t">text</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-2">&nbsp;</div><div class="crayon-line" id="crayon-53d102f9e971b183234581-3"><span class="crayon-st">INSERT</span><span class="crayon-h"> </span><span class="crayon-st">INTO</span><span class="crayon-h"> </span>mimeo_preserve_privs_temp<span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-4"><span class="crayon-st">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'GRANT EXECUTE ON FUNCTION @extschema@.logdel_maker(text, int, text, boolean, text[], text, boolean, text[], text[], boolean) TO '</span>||<span class="crayon-e ">array_to_string</span>(<span class="crayon-e ">array_agg</span>(grantee::<span class="crayon-t">text</span>),<span class="crayon-h"> </span><span class="crayon-s">','</span>)||<span class="crayon-s">';'</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53d102f9e971b183234581-5"><span class="crayon-st">FROM</span><span class="crayon-h"> </span>information_schema.routine_privileges</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-6"><span class="crayon-st">WHERE</span><span class="crayon-h"> </span>routine_schema<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'@extschema@'</span></div><div class="crayon-line" id="crayon-53d102f9e971b183234581-7"><span class="crayon-r">AND</span><span class="crayon-h"> </span>routine_name<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'logdel_maker'</span>;<span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-8">&nbsp;</div><div class="crayon-line" id="crayon-53d102f9e971b183234581-9"><span class="crayon-st">INSERT</span><span class="crayon-h"> </span><span class="crayon-st">INTO</span><span class="crayon-h"> </span>mimeo_preserve_privs_temp<span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-10"><span class="crayon-st">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'GRANT EXECUTE ON FUNCTION @extschema@.refresh_logdel(text, int, boolean, boolean) TO '</span>||<span class="crayon-e ">array_to_string</span>(<span class="crayon-e ">array_agg</span>(grantee::<span class="crayon-t">text</span>),<span class="crayon-h"> </span><span class="crayon-s">','</span>)||<span class="crayon-s">';'</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-53d102f9e971b183234581-11"><span class="crayon-st">FROM</span><span class="crayon-h"> </span>information_schema.routine_privileges</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-12"><span class="crayon-st">WHERE</span><span class="crayon-h"> </span>routine_schema<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'@extschema@'</span></div><div class="crayon-line" id="crayon-53d102f9e971b183234581-13"><span class="crayon-r">AND</span><span class="crayon-h"> </span>routine_name<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'refresh_logdel'</span>;<span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-14">&nbsp;</div><div class="crayon-line" id="crayon-53d102f9e971b183234581-15"><span class="crayon-st">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>replay_preserved_privs()<span class="crayon-h"> </span><span class="crayon-r">RETURNS</span><span class="crayon-h"> </span>void</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">LANGUAGE</span><span class="crayon-h"> </span><span class="crayon-r">plpgsql</span></div><div class="crayon-line" id="crayon-53d102f9e971b183234581-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">AS</span><span class="crayon-h"> </span>$$</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-18"><span class="crayon-st">DECLARE</span></div><div class="crayon-line" id="crayon-53d102f9e971b183234581-19">v_row<span class="crayon-h">&nbsp;&nbsp; </span>record;</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-20"><span class="crayon-st">BEGIN</span></div><div class="crayon-line" id="crayon-53d102f9e971b183234581-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">FOR</span><span class="crayon-h"> </span>v_row<span class="crayon-h"> </span><span class="crayon-st">IN</span><span class="crayon-h"> </span><span class="crayon-st">SELECT</span><span class="crayon-h"> </span><span class="crayon-r">statement</span><span class="crayon-h"> </span><span class="crayon-st">FROM</span><span class="crayon-h"> </span>mimeo_preserve_privs_temp<span class="crayon-h"> </span><span class="crayon-st">LOOP</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">EXECUTE</span><span class="crayon-h"> </span>v_row.<span class="crayon-r">statement</span>;</div><div class="crayon-line" id="crayon-53d102f9e971b183234581-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">END LOOP</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-24"><span class="crayon-st">END</span></div><div class="crayon-line" id="crayon-53d102f9e971b183234581-25">$$;</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-26">&nbsp;</div><div class="crayon-line" id="crayon-53d102f9e971b183234581-27"><span class="crayon-st">DROP</span><span class="crayon-h"> </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>@extschema@.logdel_maker(<span class="crayon-t">text</span>,<span class="crayon-h"> </span><span class="crayon-t">int</span>,<span class="crayon-h"> </span><span class="crayon-t">text</span>,<span class="crayon-h"> </span><span class="crayon-t">boolean</span>,<span class="crayon-h"> </span><span class="crayon-t">text</span>[],<span class="crayon-h"> </span><span class="crayon-t">text</span>,<span class="crayon-h"> </span><span class="crayon-t">boolean</span>,<span class="crayon-h"> </span><span class="crayon-t">text</span>[],<span class="crayon-h"> </span><span class="crayon-t">text</span>[]);</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-28"><span class="crayon-st">DROP</span><span class="crayon-h"> </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>@extschema@.refresh_logdel(<span class="crayon-t">text</span>,<span class="crayon-h"> </span><span class="crayon-t">int</span>,<span class="crayon-h"> </span><span class="crayon-t">boolean</span>);</div><div class="crayon-line" id="crayon-53d102f9e971b183234581-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-30">[...<span class="crayon-h"> </span>Bunch<span class="crayon-h"> </span><span class="crayon-r">of</span><span class="crayon-h"> </span>code<span class="crayon-h"> </span>that<span class="crayon-h"> </span>does<span class="crayon-h"> </span>the<span class="crayon-h"> </span>actual<span class="crayon-h"> </span><span class="crayon-st">update</span><span class="crayon-h"> </span>here<span class="crayon-h"> </span>...]</div><div class="crayon-line" id="crayon-53d102f9e971b183234581-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-32"><span class="crayon-st">SELECT</span><span class="crayon-h"> </span>@extschema@.replay_preserved_privs();</div><div class="crayon-line" id="crayon-53d102f9e971b183234581-33"><span class="crayon-st">DROP</span><span class="crayon-h"> </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>@extschema@.replay_preserved_privs();</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e971b183234581-34"><span class="crayon-st">DROP</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span>mimeo_preserve_privs_temp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0071 seconds] -->
<p>I&#8217;m really glad this works because it&#8217;s much less complicated than I was thinking it was going to be. I just create a temp table to hold the grant commands with the original privileges, run some SQL to generate them, have a temp function that goes back and replays them at the end of the update and then drops the unneeded objects. If you look closely, the generated GRANT statement has the signature of the new function while the DROP statement has the old function signature.</p>
<p>The refresh functions (refresh_logdel() here) are functions that we&#8217;ve typically given permissions to other users to execute so they can refresh tables on demand as needed. You could check those permissions before the update, make note of them, and reapply them afterwards. But I think it&#8217;s much more preferable for the extension update to handle it itself if it can. This same method can be used to preserve permissions on any object just by looking it up in the relevant <a href="http://www.postgresql.org/docs/current/static/information-schema.html" target="_blank">information_schema</a> view.</p>
<p>Don&#8217;t know if this is the best way to do this, but so far it works. I&#8217;d appreciate any feedback if anyone has a better approach.</p>
<p><strong>UPDATE 2014/02/14: </strong>At the time I wrote this post I wasn&#8217;t really familiar with the <a href="http://www.postgresql.org/docs/9.0/static/sql-do.html" target="_blank">anonymous DO block.</a> Since then I&#8217;ve redone this process and completely eliminated the need for the function. Redoing the code block above, you can see it simplifies things a lot.</p><!-- Crayon Syntax Highlighter v2.6.5 -->

		<div id="crayon-53d102f9e972c336597034" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
CREATE TEMP TABLE mimeo_preserve_privs_temp (statement text);

INSERT INTO mimeo_preserve_privs_temp
SELECT 'GRANT EXECUTE ON FUNCTION @extschema@.logdel_maker(text, int, text, boolean, text[], text, boolean, text[], text[], boolean) TO '||array_to_string(array_agg(grantee::text), ',')||';'
FROM information_schema.routine_privileges
WHERE routine_schema = '@extschema@'
AND routine_name = 'logdel_maker';

INSERT INTO mimeo_preserve_privs_temp
SELECT 'GRANT EXECUTE ON FUNCTION @extschema@.refresh_logdel(text, int, boolean, boolean) TO '||array_to_string(array_agg(grantee::text), ',')||';'
FROM information_schema.routine_privileges
WHERE routine_schema = '@extschema@'
AND routine_name = 'refresh_logdel'; 

DROP FUNCTION @extschema@.logdel_maker(text, int, text, boolean, text[], text, boolean, text[], text[]);
DROP FUNCTION @extschema@.refresh_logdel(text, int, boolean);

[... Bunch of code that does the actual update here ...]

DO $$
DECLARE
v_row   record;
BEGIN
    FOR v_row IN SELECT statement FROM mimeo_preserve_privs_temp LOOP
        EXECUTE v_row.statement;
    END LOOP;
END
$$;

DROP TABLE mimeo_preserve_privs_temp;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-2">2</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-4">4</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-6">6</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-8">8</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-10">10</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-12">12</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-14">14</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-16">16</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-18">18</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-20">20</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-22">22</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-24">24</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-26">26</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-28">28</div><div class="crayon-num" data-line="crayon-53d102f9e972c336597034-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-53d102f9e972c336597034-30">30</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-53d102f9e972c336597034-1"><span class="crayon-e">CREATE </span><span class="crayon-e">TEMP </span><span class="crayon-e">TABLE </span><span class="crayon-e">mimeo_preserve_privs_temp</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">statement </span><span class="crayon-v">text</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-2">&nbsp;</div><div class="crayon-line" id="crayon-53d102f9e972c336597034-3"><span class="crayon-e">INSERT </span><span class="crayon-e">INTO </span><span class="crayon-e">mimeo_preserve_privs_temp</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-4"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'GRANT EXECUTE ON FUNCTION @extschema@.logdel_maker(text, int, text, boolean, text[], text, boolean, text[], text[], boolean) TO '</span><span class="crayon-o">||</span><span class="crayon-e">array_to_string</span><span class="crayon-sy">(</span><span class="crayon-e">array_agg</span><span class="crayon-sy">(</span><span class="crayon-v">grantee</span><span class="crayon-o">::</span><span class="crayon-v">text</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">','</span><span class="crayon-sy">)</span><span class="crayon-o">||</span><span class="crayon-s">';'</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-5"><span class="crayon-e">FROM </span><span class="crayon-v">information_schema</span><span class="crayon-sy">.</span><span class="crayon-e">routine_privileges</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-6"><span class="crayon-e">WHERE </span><span class="crayon-v">routine_schema</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'@extschema@'</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-7"><span class="crayon-st">AND</span><span class="crayon-h"> </span><span class="crayon-v">routine_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'logdel_maker'</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-8">&nbsp;</div><div class="crayon-line" id="crayon-53d102f9e972c336597034-9"><span class="crayon-e">INSERT </span><span class="crayon-e">INTO </span><span class="crayon-e">mimeo_preserve_privs_temp</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-10"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'GRANT EXECUTE ON FUNCTION @extschema@.refresh_logdel(text, int, boolean, boolean) TO '</span><span class="crayon-o">||</span><span class="crayon-e">array_to_string</span><span class="crayon-sy">(</span><span class="crayon-e">array_agg</span><span class="crayon-sy">(</span><span class="crayon-v">grantee</span><span class="crayon-o">::</span><span class="crayon-v">text</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">','</span><span class="crayon-sy">)</span><span class="crayon-o">||</span><span class="crayon-s">';'</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-11"><span class="crayon-e">FROM </span><span class="crayon-v">information_schema</span><span class="crayon-sy">.</span><span class="crayon-e">routine_privileges</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-12"><span class="crayon-e">WHERE </span><span class="crayon-v">routine_schema</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'@extschema@'</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-13"><span class="crayon-st">AND</span><span class="crayon-h"> </span><span class="crayon-v">routine_name</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'refresh_logdel'</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-14">&nbsp;</div><div class="crayon-line" id="crayon-53d102f9e972c336597034-15"><span class="crayon-e">DROP </span><span class="crayon-t">FUNCTION</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-v">extschema</span><span class="crayon-sy">@</span><span class="crayon-sy">.</span><span class="crayon-e">logdel_maker</span><span class="crayon-sy">(</span><span class="crayon-v">text</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">boolean</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">boolean</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">text</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-16"><span class="crayon-e">DROP </span><span class="crayon-t">FUNCTION</span><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-v">extschema</span><span class="crayon-sy">@</span><span class="crayon-sy">.</span><span class="crayon-e">refresh_logdel</span><span class="crayon-sy">(</span><span class="crayon-v">text</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">boolean</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-18"><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-e">Bunch </span><span class="crayon-e">of </span><span class="crayon-e">code </span><span class="crayon-e">that </span><span class="crayon-e">does </span><span class="crayon-e">the </span><span class="crayon-e">actual </span><span class="crayon-e">update </span><span class="crayon-i">here</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-20"><span class="crayon-st">DO</span><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-sy">$</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-21"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-22"><span class="crayon-e">v_row&nbsp;&nbsp; </span><span class="crayon-v">record</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-23"><span class="crayon-e">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-24"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">FOR</span><span class="crayon-h"> </span><span class="crayon-e">v_row </span><span class="crayon-st">IN</span><span class="crayon-h"> </span><span class="crayon-e">SELECT </span><span class="crayon-e">statement </span><span class="crayon-e">FROM </span><span class="crayon-e">mimeo_preserve_privs_temp </span><span class="crayon-e">LOOP</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-25"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">EXECUTE </span><span class="crayon-v">v_row</span><span class="crayon-sy">.</span><span class="crayon-v">statement</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">END</span><span class="crayon-h"> </span><span class="crayon-v">LOOP</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-27"><span class="crayon-st">END</span></div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-28"><span class="crayon-sy">$</span><span class="crayon-sy">$</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-53d102f9e972c336597034-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-53d102f9e972c336597034-30"><span class="crayon-e">DROP </span><span class="crayon-e">TABLE </span><span class="crayon-v">mimeo_preserve_privs_temp</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0061 seconds] -->
<p>&nbsp;</p>
</div>

<div class="meta group">
<div class="signature">
    <p>Written by Keith <span class="edit"></span></p>
    <p>March 28th, 2013 at 12:51 pm</p>
</div>	
<div class="tags">
    <p>Posted in <a href="http://www.keithf4.com/category/postgresql-stuff/" title="View all posts in PostgreSQL" rel="category tag">PostgreSQL</a></p>
    <p>Tagged with <a href="http://www.keithf4.com/tag/extensions/" rel="tag">extensions</a>, <a href="http://www.keithf4.com/tag/mimeo/" rel="tag">mimeo</a>, <a href="http://www.keithf4.com/tag/postgresql/" rel="tag">postgresql</a>, <a href="http://www.keithf4.com/tag/tips/" rel="tag">tips</a></p></div>
</div>

<div class="navigation group">
    <div class="alignleft">&laquo; <a href="http://www.keithf4.com/mimeo-dml-replication/" rel="prev">Mimeo &#8211; DML Replication</a></div>
    <div class="alignright"><a href="http://www.keithf4.com/mimeo-repulling-incremental-replication-data/" rel="next">Mimeo &#8211; Repulling Incremental Replication Data</a> &raquo;</div>
</div>


<div id="disqus_thread">
                    <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="comment even thread-even depth-1" id="dsq-comment-841">
        <div id="dsq-comment-header-841" class="dsq-comment-header">
            <cite id="dsq-cite-841">
http://www.facebook.com/oleg.bartunov                <span id="dsq-author-user-841">Oleg Bartunov</span>
            </cite>
        </div>
        <div id="dsq-comment-body-841" class="dsq-comment-body">
            <div id="dsq-comment-message-841" class="dsq-comment-message"><p>don&#8217;t forget, that creation of temp table makes pg_class bigger and autovacuum doesn&#8217;t vacuum system tables, so you may surprise to see all selects became slower.</p>
</div>
        </div>

    <ul class="children">
    <li class="comment odd alt depth-2" id="dsq-comment-842">
        <div id="dsq-comment-header-842" class="dsq-comment-header">
            <cite id="dsq-cite-842">
                <span id="dsq-author-user-842">keithf4</span>
            </cite>
        </div>
        <div id="dsq-comment-body-842" class="dsq-comment-body">
            <div id="dsq-comment-message-842" class="dsq-comment-message"><p>That&#8217;s true, but extension updates are a once and done thing, so the impact on pg_class should be very minimal. It&#8217;s one temp table for the entire update. Normal use of most databases I&#8217;ve come across create far more temp tables on a regular basis than this. </p>
<p>I&#8217;m open to suggestions on a method without using temp tables. But this seemed to be the best way to manage keeping track of privileges for multiple objects and replaying them all in a simple way.</p>
</div>
        </div>

    </li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
            </ul>


        </div>

    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://www.keithf4.com/preserve-extension-privs/';
    var disqus_identifier = '263 http://www.keithf4.com/?p=263';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'keithf4';
    var disqus_title = "PostgreSQL Extension Updates &#038; Preserving Privileges";
    var disqus_config = function () {
        var config = this; // Access to the config object
        config.language = '';

        /* Add the ability to add javascript callbacks */
        
        /*
           All currently supported events:
            * preData â€” fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = '?cf_action=sync_comments&post_id=263';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/www.keithf4.com\/preserve-extension-privs\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.' + 'disqus.com' + '/' + 'embed' + '.js' + '?pname=wordpress&pver=2.77';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>


</div> 

<div id="sidebar">
<h3>My Stuff</h3>		<ul>
			<li class="page_item page-item-24"><a href="http://www.keithf4.com/projects/">Projects</a></li>
<li class="page_item page-item-512"><a href="http://www.keithf4.com/publications/">Publications</a></li>
		</ul>
					<div class="textwidget"><script src="http://coinwidget.com/widget/coin.js"></script>
<script>
CoinWidgetCom.go({
        wallet_address: "19cf6fhqCUNV7wzpWQW4DPEWh8MyLhfbu"
        , currency: "bitcoin"
        , counter: "count"
        , alignment: "bl"
        , qrcode: true
        , auto_show: false
        , lbl_button: "Donate"
        , lbl_address: "My Bitcoin Address:"
        , lbl_count: "donations"
        , lbl_amount: "BTC"
});
</script>
<br><br>
<a href="http://steamcommunity.com/profiles/76561197984029286/wishlist/" target="_blank">Steam Wishlist</a></div>
		<form role="search" method="get" id="searchform" class="searchform" action="http://www.keithf4.com/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>				<h3>Recent Posts</h3>		<ul>
					<li>
				<a href="http://www.keithf4.com/table-partitioning-and-foreign-keys/">Table Partitioning and Foreign Keys</a>
						</li>
					<li>
				<a href="http://www.keithf4.com/partitioning-with-custom-time-intervals/">Partitioning With Custom Time Intervals</a>
						</li>
					<li>
				<a href="http://www.keithf4.com/version-specific-postgresql-extension-features/">Version Specific PostgreSQL Extension Features</a>
						</li>
					<li>
				<a href="http://www.keithf4.com/managing-constraint-exclusion-in-table-partitioning/">Managing Constraint Exclusion in Table Partitioning</a>
						</li>
					<li>
				<a href="http://www.keithf4.com/monitoring_streaming_slave_lag/">Monitoring Streaming Slave Lag Effectively</a>
						</li>
				</ul>
		<h3>Tags</h3><div class="tagcloud"><a href='http://www.keithf4.com/tag/backup/' class='tag-link-22' title='1 topic' style='font-size: 8pt;'>backup</a>
<a href='http://www.keithf4.com/tag/circonus/' class='tag-link-11' title='1 topic' style='font-size: 8pt;'>circonus</a>
<a href='http://www.keithf4.com/tag/dst/' class='tag-link-16' title='1 topic' style='font-size: 8pt;'>dst</a>
<a href='http://www.keithf4.com/tag/extensions/' class='tag-link-25' title='17 topics' style='font-size: 19.586206896552pt;'>extensions</a>
<a href='http://www.keithf4.com/tag/fdw/' class='tag-link-18' title='2 topics' style='font-size: 10.172413793103pt;'>fdw</a>
<a href='http://www.keithf4.com/tag/full-text-search/' class='tag-link-6' title='1 topic' style='font-size: 8pt;'>full-text search</a>
<a href='http://www.keithf4.com/tag/logging/' class='tag-link-14' title='3 topics' style='font-size: 11.620689655172pt;'>logging</a>
<a href='http://www.keithf4.com/tag/mimeo/' class='tag-link-26' title='6 topics' style='font-size: 14.637931034483pt;'>mimeo</a>
<a href='http://www.keithf4.com/tag/minecraft/' class='tag-link-21' title='1 topic' style='font-size: 8pt;'>minecraft</a>
<a href='http://www.keithf4.com/tag/monitoring/' class='tag-link-9' title='5 topics' style='font-size: 13.793103448276pt;'>monitoring</a>
<a href='http://www.keithf4.com/tag/nagios/' class='tag-link-10' title='1 topic' style='font-size: 8pt;'>nagios</a>
<a href='http://www.keithf4.com/tag/oracle/' class='tag-link-17' title='2 topics' style='font-size: 10.172413793103pt;'>oracle</a>
<a href='http://www.keithf4.com/tag/partitioning/' class='tag-link-28' title='4 topics' style='font-size: 12.827586206897pt;'>partitioning</a>
<a href='http://www.keithf4.com/tag/pg_dump/' class='tag-link-13' title='2 topics' style='font-size: 10.172413793103pt;'>pg_dump</a>
<a href='http://www.keithf4.com/tag/pg_extractor/' class='tag-link-12' title='2 topics' style='font-size: 10.172413793103pt;'>pg_extractor</a>
<a href='http://www.keithf4.com/tag/pg_jobmon/' class='tag-link-8' title='5 topics' style='font-size: 13.793103448276pt;'>pg_jobmon</a>
<a href='http://www.keithf4.com/tag/pg_partman/' class='tag-link-29' title='6 topics' style='font-size: 14.637931034483pt;'>pg_partman</a>
<a href='http://www.keithf4.com/tag/pg_upgrade/' class='tag-link-15' title='1 topic' style='font-size: 8pt;'>pg_upgrade</a>
<a href='http://www.keithf4.com/tag/postgresql/' class='tag-link-3' title='28 topics' style='font-size: 22pt;'>postgresql</a>
<a href='http://www.keithf4.com/tag/replication/' class='tag-link-27' title='5 topics' style='font-size: 13.793103448276pt;'>replication</a>
<a href='http://www.keithf4.com/tag/schema/' class='tag-link-24' title='1 topic' style='font-size: 8pt;'>schema</a>
<a href='http://www.keithf4.com/tag/tips/' class='tag-link-4' title='8 topics' style='font-size: 15.844827586207pt;'>tips</a>
<a href='http://www.keithf4.com/tag/wuala/' class='tag-link-23' title='1 topic' style='font-size: 8pt;'>wuala</a></div>
<h3>Recent Comments</h3><ul id="recentcomments"><li class="recentcomments">arun desai on <a href="http://www.keithf4.com/table-partitioning-and-foreign-keys/#comment-914">Table Partitioning and Foreign Keys</a></li><li class="recentcomments">keithf4 on <a href="http://www.keithf4.com/table-partitioning-and-foreign-keys/#comment-913">Table Partitioning and Foreign Keys</a></li><li class="recentcomments">arun desai on <a href="http://www.keithf4.com/table-partitioning-and-foreign-keys/#comment-912">Table Partitioning and Foreign Keys</a></li><li class="recentcomments">keithf4 on <a href="http://www.keithf4.com/managing-constraint-exclusion-in-table-partitioning/#comment-911">Managing Constraint Exclusion in Table Partitioning</a></li><li class="recentcomments">arun desai on <a href="http://www.keithf4.com/managing-constraint-exclusion-in-table-partitioning/#comment-910">Managing Constraint Exclusion in Table Partitioning</a></li></ul><h3>About Me</h3>			<div class="textwidget">I'm a database administrator with <a href="http://www.omniti.com">OmniTI, Inc</a> and play way too many video games. You can find me lurking in #postgresql on <a href="http://freenode.net/">Freenode IRC</a>
or join me in <a href="https://secure.eveonline.com/trial/?invc=afd96c42-585c-4789-94ee-2677abcc9f33&action=buddy" target="_blank">Tranquility</a>.</div>
		<h3>Archives</h3>		<ul>
	<li><a href='http://www.keithf4.com/2014/05/'>May 2014</a></li>
	<li><a href='http://www.keithf4.com/2014/02/'>February 2014</a></li>
	<li><a href='http://www.keithf4.com/2014/01/'>January 2014</a></li>
	<li><a href='http://www.keithf4.com/2013/10/'>October 2013</a></li>
	<li><a href='http://www.keithf4.com/2013/09/'>September 2013</a></li>
	<li><a href='http://www.keithf4.com/2013/07/'>July 2013</a></li>
	<li><a href='http://www.keithf4.com/2013/04/'>April 2013</a></li>
	<li><a href='http://www.keithf4.com/2013/03/'>March 2013</a></li>
	<li><a href='http://www.keithf4.com/2013/02/'>February 2013</a></li>
	<li><a href='http://www.keithf4.com/2013/01/'>January 2013</a></li>
	<li><a href='http://www.keithf4.com/2012/12/'>December 2012</a></li>
	<li><a href='http://www.keithf4.com/2012/11/'>November 2012</a></li>
	<li><a href='http://www.keithf4.com/2012/10/'>October 2012</a></li>
	<li><a href='http://www.keithf4.com/2012/07/'>July 2012</a></li>
	<li><a href='http://www.keithf4.com/2012/06/'>June 2012</a></li>
	<li><a href='http://www.keithf4.com/2012/04/'>April 2012</a></li>
	<li><a href='http://www.keithf4.com/2012/03/'>March 2012</a></li>
	<li><a href='http://www.keithf4.com/2012/02/'>February 2012</a></li>
	<li><a href='http://www.keithf4.com/2012/01/'>January 2012</a></li>
		</ul>


</div>

</div>

<div id="footer">
	<p>The Journalist template by <a href="http://lucianmarin.com/" rel="designer">Lucian E. Marin</a> &mdash; Built for <a href="http://wordpress.org/">WordPress</a></p>
</div>

</body>
</html>
